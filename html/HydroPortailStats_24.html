<div class="container">

<table style="width: 100%;"><tr>
<td>Hydro3_HBay</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian estimation using historical data</h2>

<h3>Description</h3>

<p>Bayesian estimation of a GEV or Gumbel distribution based on a mixed sample containing 
point (i.e. perfectly known) or interval (i.e. known to be within bounds) data.
Systematic errors induced by rating curve errors can also be accounted for. 
Returns an Hydro3 object
</p>


<h3>Usage</h3>

<pre><code class="language-R">Hydro3_HBay(
  y,
  dist,
  prior = GetDefaultPrior(GetParNumber(dist)),
  SystErrorIndex = rep(0, NROW(y)),
  SystErrorPrior = list(),
  options = options_def,
  mcmcoptions = mcmcoptions_def,
  do.KS = TRUE,
  do.MK = TRUE,
  do.Pettitt = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>numeric 2-column matrix, data. 
The first column gives the lower bound, the second column gives the upper bound.
Where y[i,1]==y[i,2], the value is assumed perfectly known (up to systematic errors, see below).
Where y[i,1]&lt;y[i,2], the value is assumed to be in the interval [y[i,1];y[i,2]]
-Inf and +Inf are allowed for data being only right- or left-censored 
(i.e. values known to be smaller than or larger than some threshold).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>character, distribution name. Only distributions 'GEV' and 'Gumbel' are supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>list of lists, prior distributions. For each parameter to be estimated, the prior
is a list of the form pr=list(dist=..., par=...). See example below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SystErrorIndex</code></td>
<td>
<p>integer vector, length NROW(y). Index of systematic errors.
Rows where SystErrorIndex==k are all affected by the same multiplicative error gamma_k, 
typically induced by the kth rating curve. SystErrorIndex==0 means no systematic error.
Should only contain integer values between 0 and N_{systematic errors}.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SystErrorPrior</code></td>
<td>
<p>list of lists,  prior distribution for each systematic error.
For instance for a systematic error in the range +/- 20%, you may use a Uniform
between 0.8 and 1.2, or a triangular distribution with the same bounds and peak at 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>list, options, see details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmcoptions</code></td>
<td>
<p>list, MCMC options, see details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.KS, do.MK, do.Pettitt</code></td>
<td>
<p>logical, perform KS/MK/Pettitt tests?</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The argument 'options' allows controlling various properties of the analysis and results.
It is a list with the following components:
</p>

<ul>
<li>
<p>FreqFormula, character, formula for computing nonexceedance frequency, see ?GetEmpFreq.
</p>
</li>
<li>
<p>pgrid, numeric vector, probabilities defining the x values where pdf f(x) and cdf F(x) 
are computed. These x values are quantiles from the estimated distribution 
with probabilities pgrid.
</p>
</li>
<li>
<p>Tgrid, numeric vector, return periods where quantile function q(T) is computed.
</p>
</li>
<li>
<p>IClevel, numeric, level of uncertainty interval.
</p>
</li>
<li>
<p>p2T, numeric, conversion factor between nonexceedance probability p and return period T.
p=1-1/(p2T*T). Here p2T=1 in general since GEV/Gumbel are applied to annual maxima in general.
</p>
</li>
<li>
<p>invertT, logical, when invertT=TRUE, LARGE return periods correspond to SMALL data values.
This is typically used for low-flow statistics. Unused here.
</p>
</li>
<li>
<p>splitZeros, logical, when splitZeros=TRUE zero and negative values are removed from the data y before 
estimating the distribution,and are used to estimate the probability of zeros p0. This is 
typically used for low-flow statistics to estimate the probability of zero streamflow. Unused here.
</p>
</li>
<li>
<p>lang, chanracter, language ('fr' or 'en').
</p>
</li>
<li>
<p>nsim, integer, number of replicated parameters representing uncertainty. Unused here (derives from mcmc options)
</p>
</li>
</ul>
<p>The argument 'mcmcoptions' is a list controlling MCMC properties: 
</p>

<ul>
<li>
<p>mult, numeric, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>eps, numeric, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>batch.length, integer, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>batch.n, integer, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>moverate.min, numeric, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>moverate.max, numeric, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>mult.down, numeric, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>mult.up, numeric, see ?Metropolis_OAAT_adaptive
</p>
</li>
<li>
<p>burn, numeric, burn-in factor, e.g. if burn=0.2 the first 20 percents of MCMC samples are discarded
</p>
</li>
<li>
<p>slim, integer, sliming factor, e.g. if slim=5 only one MCMC sample every 5 is kept (after burn-in)
</p>
</li>
</ul>
<h3>Value</h3>

<p>A list with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>character, estimated distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ok</code></td>
<td>
<p>logical, did estimation succeed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>err</code></td>
<td>
<p>integer, error code (0 if ok).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p>error message.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>empirical</code></td>
<td>
<p>data frame, sorted data and empirical estimates 
(nonexceedance frequency, return period and reduced variate). 
NOTE: interval data are replaced by a value randomly sampled from
a GEV constrained in this interval. See ?GenerateWithinBounds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pcdf</code></td>
<td>
<p>data frame, estimated pdf and cdf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile</code></td>
<td>
<p>data frame, estimated quantiles and uncertainty intervals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par</code></td>
<td>
<p>data frame, estimated parameters and uncertainty intervals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>KS</code></td>
<td>
<p>list, result of the Kolmogorov-Smirnov test, see ?KS.
NOTE: interval data are replaced by a value randomly sampled from
a GEV constrained in this interval. See ?HBay_simGEV.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MK</code></td>
<td>
<p>list, result of the Mann-Kendall test, see ?MK. Same note as KS test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Pettitt</code></td>
<td>
<p>list, result of the Pettitt test, see ?Pettitt. Same note as KS test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>list, parameter uncertainty in the form of a covariance matrix ($cov)
and simulated parameter replicates ($sim). Also contains error-handling flags 
$ok, $err and $message.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">set.seed(98765)
n=50;n_censored=30
y0=Generate('GEV',c(100,50,-0.2),n)
y=cbind(y0,y0)
# Mimics censoring between 0 and 300 for first n_censored years
y[1:n_censored,1][y0[1:n_censored]&lt;300]=0
y[1:n_censored,2][y0[1:n_censored]&lt;300]=300
plot(y[,1]);points(y[,2])
# Systematic errors
SystErrorIndex=c(rep(1,n_censored),rep(2,n-n_censored))
SystErrorPrior=list(list(dist="Triangle",par=c(1,0.7,1.3)),
                    list(dist="Triangle",par=c(1,0.95,1.05)))
# Priors on GEV parameters
prior=list(list(dist="FlatPrior",par=NULL),
           list(dist="FlatPrior",par=NULL),
           list(dist="Normal",par=c(0,0.25)))
# Handle MCMC options
# The values below aim at making this example fast to run.
# In practice, it is recommended to use the default values
# (batch.length=100,batch.n=100) or larger.
mcmcoptions=mcmcoptions_def
mcmcoptions$batch.length=25
mcmcoptions$batch.n=20
# Go!
H3=Hydro3_HBay(y=y,dist='GEV',prior=prior,
               SystErrorIndex=SystErrorIndex,
               SystErrorPrior=SystErrorPrior,
               mcmcoptions=mcmcoptions) 
Hydro3_Plot(H3)
</code></pre>


</div>
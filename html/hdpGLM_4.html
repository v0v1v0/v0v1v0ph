<div class="container">

<table style="width: 100%;"><tr>
<td>hdpGLM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit Hierarchical Dirichlet Process GLM</h2>

<h3>Description</h3>

<p>The function estimates a semi-parametric mixture of Generalized
Linear Models. It uses a (hierarchical) Dependent Dirichlet Process
Prior for the mixture probabilities.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hdpGLM(
  formula1,
  formula2 = NULL,
  data,
  mcmc,
  family = "gaussian",
  K = 100,
  context.id = NULL,
  constants = NULL,
  weights = NULL,
  n.display = 1000,
  na.action = "exclude",
  imp.bin = "R"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula1</code></td>
<td>
<p>a single symbolic description of the linear model of the
mixture GLM components to be fitted. The syntax is the same
as used in the <code>lm</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula2</code></td>
<td>
<p>eihter NULL (default) or a single symbolic description of the
linear model of the hierarchical component of the model.
It specifies how the average parameter of the base measure
of the Dirichlet Process Prior varies linearly as a function
of group level covariates. If <code>NULL</code>, it will use
a single base measure to the DPP mixture model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data.frame with all the variables specified in <code>formula1</code> and <code>formula2</code>. Note: it is advisable to scale the variables before the estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc</code></td>
<td>
<p>a named list with the following elements
</p>
<p>- <code>burn.in</code> (required): an integer greater or equal to 0
indicating the number iterations used in the
burn-in period of the MCMC.
</p>
<p>- <code>n.iter</code>  (required): an integer greater or equal to 1
indicating the number of iterations to record
after the burn-in period for the MCMC.
</p>
<p>- <code>epsilon</code> (optional): a positive number. Default is 0.01.
Used when <code>family='binomial'</code> or
<code>family='multinomial'</code>. It is used in the
Stormer-Verlet Integrator (a.k.a leapfrog
integrator) to solve the Hamiltonian Monte
Carlo in the estimation of the model.
</p>
<p>- <code>leapFrog</code> (optional) an integer. Default is 40. Used when
<code>family='binomial'</code> or <code>family='multinomial'</code>.
It indicates the number of steps taken at each
iteration of the Hamiltonian Monte Carlo for
the Stormer-Verlet Integrator.
</p>
<p>- <code>hmc_iter</code> (optional) an integer. Default is 1. Used when 
<code>family='binomial'</code> or <code>family='multinomial'</code>.
It indicates the number of HMC iteration(s)
for each Gibbs iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a character with either 'gaussian', 'binomial', or 'multinomial'.
It indicates the family of the GLM components of the mixture model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>an integer indicating the maximum number of clusters to truncate the
Dirichlet Process Prior in order to use the blocked Gibbs sampler.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>context.id</code></td>
<td>
<p>string with the name of the column in the data that uniquely identifies the contexts. If <code>NULL</code> (default) contexts will be identified by numerical indexes and unique context-level variables. The user is advised to pre-process the data to provide meaningful labels for the contexts to facilitate later visualization and analysis of the results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constants</code></td>
<td>
<p>either NULL or a list with the constants of the model. If not NULL,
it must contain a vector named <code>mu_beta</code>, whose size must be
equal to the number of covariates specified in <code>formula1</code>
plus one for the constant term; <code>Sigma_beta</code>, which must be a squared
matrix, and each dimension must be equal to the size of the vector <code>mu_beta</code>; 
and <code>alpha</code>, which must be a single number. If @param family is 'gaussian',
then it must also contain <code>s2_sigma</code> and <code>df_sigma</code>, both
single numbers. If NULL, the defaults are <code>mu_beta=0</code>,
<code>Sigma_beta=diag(10)</code>, <code>alpha=1</code>, <code>df_sigma=10</code>,
<code>s2_sigma=10</code> (all with the dimension automatically set to the
correct values).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>numeric vector with the same size as the number of rows of the data. It must contain the weights of the observations in the data set. NOTE: FEATURE NOT IMPLEMENTED YET</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.display</code></td>
<td>
<p>an integer indicating the number of iterations to wait before printing information
about the estimation process. If zero, it does not display any information.
Note: displaying informaiton at every iteration (n.display=1) may increase
the time to estimate the model slightly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>string with action to be taken for the <code>NA</code> values. (currently, only <code>exclude</code> is available)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imp.bin</code></td>
<td>
<p>string, either "R" or "Cpp" indicating the language of the implementation of the binomial model.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function estimates a Hierarchical Dirichlet Process generalized
linear model, which is a semi-parametric Bayesian approach to regression
estimation with clustering. The estimation is conducted using Blocked Gibbs Sampler if the output
variable is gaussian distributed. It uses Metropolis-Hastings inside Gibbs if
the output variable is binomial or multinomial distributed.
This is specified using the parameter <code>family</code>. See:
</p>
<p>Ferrari, D. (2020). Modeling Context-Dependent Latent Effect Heterogeneity,
Political Analysis, 28(1), 20–46. doi:10.1017/pan.2019.13.
</p>
<p>Ferrari, D. (2023). "hdpGLM: An R Package to Estimate Heterogeneous Effects
in Generalized Linear Models Using Hierarchical Dirichlet Process."
Journal of Statistical Software, 107(10), 1-37. doi:10.18637/jss.v107.i10.
</p>
<p>Ishwaran, H., &amp; James, L. F., Gibbs sampling methods for stick-breaking priors,
Journal of the American Statistical Association, 96(453), 161–173 (2001). 
</p>
<p>Neal, R. M., Markov chain sampling methods for dirichlet process mixture models,
Journal of computational and graphical statistics, 9(2), 249–265 (2000).
</p>


<h3>Value</h3>

<p>The function returns a list with elements <code>samples</code>, <code>pik</code>, <code>max_active</code>,
<code>n.iter</code>, <code>burn.in</code>, and <code>time.elapsed</code>. The <code>samples</code> element
contains a MCMC object (from <span class="pkg">coda</span> package) with the samples from the posterior
distribution. The <code>pik</code> is a <code>n x K</code> matrix with the estimated
probabilities that the observation $i$ belongs to the cluster $k$
</p>


<h3>Examples</h3>

<pre><code class="language-R">

## Note: this example is for illustration. You can run the example
## manually with increased number of iterations to see the actual
## results, as well as the data size (n)

set.seed(10)
n = 300
data = tibble::tibble(x1 = rnorm(n, -3),
                      x2 = rnorm(n,  3),
                      z  = sample(1:3, n, replace=TRUE),
                      y  =I(z==1) * (3 + 4*x1 - x2 + rnorm(n)) +
                          I(z==2) * (3 + 2*x1 + x2 + rnorm(n)) +
                          I(z==3) * (3 - 4*x1 - x2 + rnorm(n)) 
                      ) 


mcmc    = list(burn.in = 0,  n.iter = 20)
samples = hdpGLM(y~ x1 + x2, data=data, mcmc=mcmc, family='gaussian',
                 n.display=30, K=50)

summary(samples)
plot(samples)
plot(samples, separate=TRUE)

## compare with GLM
## lm(y~ x1 + x2, data=data,  family='gaussian')

 
</code></pre>


</div>
<div class="container">

<table style="width: 100%;"><tr>
<td>hglm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting Hierarchical Generalized Linear Models</h2>

<h3>Description</h3>

<p><code>hglm</code> is used to fit hierarchical generalized linear models. It can be used for linear mixed models and 
generalized linear models with random effects for a variety of links and a variety of distributions for both
the outcomes and the random effects. Fixed effects can also be fitted in the dispersion part of the model.
The function can be called either by specifying the design matrices or as a <code>formula</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hglm(X = NULL, y = NULL, Z = NULL, family = gaussian(link = identity),
     rand.family = gaussian(link = identity), method = "EQL", 
     conv = 1e-6, maxit = 50, startval = NULL, fixed = NULL, 
     random = NULL, X.disp = NULL, disp = NULL, link.disp = "log", 
     X.rand.disp = NULL, rand.disp = NULL, link.rand.disp = "log", 
     data = NULL, weights = NULL, fix.disp = NULL, offset = NULL, 
     RandC = ncol(Z), sparse = TRUE, vcovmat = FALSE, 
     calc.like = FALSE, bigRR = FALSE, verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p><code>matrix</code>. The design matrix for the fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p><code>numeric</code>. The dependent variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p><code>matrix</code>. The design matrix for the random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p><code>family</code>. The description of the error distribution and link function to be used in the mean part of the model. (See <code>family</code> for details of family functions.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rand.family</code></td>
<td>
<p><code>family</code>. The description of the distribution and link function to be used for the random effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p><code>character</code>. Estimation method where <code>EQL</code> is the method of interconnected GLMs presented in Lee et al (2006). Apart from the default option <code>EQL</code> there is also an <code>EQL1</code> option, which improves estimation for GLMMs (especially for Poisson models with a large number of levels in the random effects).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv</code></td>
<td>
<p><code>numeric</code>. The convergence criteria (change in linear predictor between iterations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p><code>numeric</code>. Maximum number of iterations in the <code>hglm</code> algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>startval</code></td>
<td>
<p><code>numeric</code>. A vector of starting values in the following order: fixed effects, random effect, variance of random effects, variance of residuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p><code>formula</code>. A <code>formula</code> specifying the fixed effects part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>
<p><code>formula</code>. A one-sided <code>formula</code> specifying the random effects part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X.disp</code></td>
<td>
<p><code>matrix</code>. The design matrix for the fixed effects in the residual dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>disp</code></td>
<td>
<p><code>formula</code>. A one-sided <code>formula</code> specifying the fixed effects in the residual dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link.disp</code></td>
<td>
<p><code>character</code>. The link function for the residual dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X.rand.disp</code></td>
<td>
<p><code>matrix</code>. The design matrix for the fixed effects in the random effects dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rand.disp</code></td>
<td>
<p><code>formula</code>. A one-sided <code>formula</code> specifying the fixed effects in the random effects dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link.rand.disp</code></td>
<td>
<p><code>character</code>. The link function for the random effects dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p><code>data.frame</code>. The data frame to be used together with <code>fixed</code> and <code>random</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p><code>numeric</code>. Prior weights to be specified in weighted regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.disp</code></td>
<td>
<p><code>numeric</code>. A numeric value if the dispersion parameter of the mean model is known, e.g., 1 for binomial and Poisson model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>An offset for the linear predictor of the mean model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RandC</code></td>
<td>
<p><code>numeric</code>. Integers (possibly a vector) specifying the number of column of Z to be used for each of the random-effect terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, the computation is to be carried out by using sparse matrix technique.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcovmat</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code>, the variance-covariance matrix is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calc.like</code></td>
<td>
<p>logical. If <code>TRUE</code>, likelihoods will be computed at convergence and will be shown via the print or summary methods on the output object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bigRR</code></td>
<td>
<p>logical. If <code>TRUE</code>, and only for the Gaussian model with one random effect term, a specific algorithm will be used for fast fitting high-dimensional (p &gt;&gt; n) problems. See Shen et al. (2013) for more details of the method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical. If <code>TRUE</code>, more information is printed during model fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>not used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Models for <code>hglm</code> are either specified symbolically using <code>formula</code> 
or by specifying the design matrices ( <code>X</code>, <code>Z</code> and <code>X.disp</code>). The extended quasi likelihood (EQL)
method is the default method for estimation of the model parameters. For the Gaussian-Gaussian linear mixed models, it
is REML. It should be noted that the EQL estimator can be biased and inconsistent in some special cases e.g. binary pair matched response. A higher order correction 
might be useful to correct the bias of EQL (Lee et al. 2006). There is also an <code>EQL1</code> option, which improves estimation for GLMMs (especially for Poisson models with a large number of levels in the random effects). The <code>EQL1</code> method computes estimates by adjusting the working response as described in the appendix of Lee and Lee (2012). <br>
By default, the dispersion
parameter is estimated by the <code>hglm</code> and <code>hglm2</code> functions. If the dispersion parameter of the mean model is to be held constant, for example if it is
desired to be 1 for binomial and Poisson family, then <code>fix.disp</code>=value where, value=1 for the above example, should be used. 
<br><br><b>Interpretation of warning messages</b> <br><em>Remove all NA before input to the hglm function.</em><br>
- This message is important and tells the user to delete all lines with missing values from the input data.<br><br><em>Residuals numerically 0 are replaced by 1e-8.</em> or <br><em>Hat-values numerically 1 are replaced by 1 - 1e-8.</em><br>
- These messages are often not important as they usually reflect a numerical issue in an intermediate step of the iterative fitting algorithm. However, it is a good idea to check that there are no hat values equal to 1 in the final output. 
</p>


<h3>Value</h3>

<p>It returns an object of class <code>hglm</code> consiting of the following values.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>fixef</code></td>
<td>
<p>fixed effect estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranef</code></td>
<td>
<p>random effect estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RandC</code></td>
<td>
<p>integers (possibly a vector) specified the number of column of Z to be used for each of the random-effect terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varFix</code></td>
<td>
<p>dispersion parameter of the mean model (residual variance for LMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varRanef</code></td>
<td>
<p>dispersion parameter of the random effects (variance of random effects for GLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CAR.rho</code></td>
<td>
<p>parameter estimate for a MRF spatial model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CAR.tau</code></td>
<td>
<p>parameter estimate for a MRF spatial model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>number of iterations used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Converge</code></td>
<td>
<p>specifies if the algorithm converged.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SeFe</code></td>
<td>
<p>standard errors of fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SeRe</code></td>
<td>
<p>standard errors of random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfReFe</code></td>
<td>
<p>deviance degrees of freedom for the mean part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SummVC1</code></td>
<td>
<p>estimates and standard errors of the linear predictor in the dispersion model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SummVC2</code></td>
<td>
<p>estimates and standard errors of the linear predictor for the dispersion parameter of the random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dev</code></td>
<td>
<p>individual deviances for the mean part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hv</code></td>
<td>
<p>hatvalues for the mean part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resid</code></td>
<td>
<p>studentized residuals for the mean part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fv</code></td>
<td>
<p>fitted values for the mean part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>disp.fv</code></td>
<td>
<p>fitted values for the dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>disp.resid</code></td>
<td>
<p>standardized deviance residuals for the dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link.disp</code></td>
<td>
<p>link function for the dispersion part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcov</code></td>
<td>
<p>the variance-covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>likelihood</code></td>
<td>
<p>a list of log-likelihood values for model selection purposes, where <code>$hlik</code> is the log-h-likelihood, <code>$pvh</code> the adjusted profile log-likelihood profiled over random effects, <code>$pbvh</code> the adjusted profile log-likelihood profiled over fixed and random effects, and <code>$cAIC</code> the conditional AIC. (NOTE: In some earlier version (version &lt;2.0) -2 times the log-likelihoods were reported.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bad</code></td>
<td>
<p>the index of the influential observation.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Moudud Alam, Lars Ronnegard, Xia Shen</p>


<h3>References</h3>

<p>Lars Ronnegard, Xia Shen and Moudud Alam (2010). <b>hglm: A Package for Fitting Hierarchical Generalized Linear Models</b>. <em>The R Journal</em>, <b>2</b>(2), 20-28.<br><br></p>
<p>Youngjo Lee, John A Nelder and Yudi Pawitan (2006) <em>Generalized Linear Models with Random Effect: a unified analysis via h-likelihood.</em> Chapman and Hall/CRC.<br><br></p>
<p>Xia Shen, Moudud Alam, Freddy Fikse and Lars Ronnegard (2013). <b>A novel generalized ridge regression method for quantitative genetics</b>. <em>Genetics</em> <b>193</b>(4), ?1255-1268. <br><br></p>
<p>Moudud Alam, Lars Ronnegard, Xia Shen (2014). <b>Fitting conditional and simultaneous autoregressive spatial models in hglm</b>. <em>Submitted</em>.<br><br></p>
<p>Woojoo Lee and Youngjo Lee (2012). <b>Modifications of REML algorithm for hglms</b>. <em>Statistics and Computing</em> <b>22</b>, 959-966.
</p>


<h3>See Also</h3>

<p><code>hglm2</code></p>


<h3>Examples</h3>

<pre><code class="language-R"># Find more examples and instructions in the package vignette:
# vignette('hglm')

require(hglm)

# --------------------- #
# semiconductor example #
# --------------------- #

data(semiconductor)

m11 &lt;- hglm(fixed = y ~ x1 + x3 + x5 + x6,
            random = ~ 1|Device,
            family = Gamma(link = log),
            disp = ~ x2 + x3, data = semiconductor)
summary(m11)
plot(m11, cex = .6, pch = 1,
     cex.axis = 1/.6, cex.lab = 1/.6,
     cex.main = 1/.6, mar = c(3, 4.5, 0, 1.5))

# ------------------- #
# redo it using hglm2 #
# ------------------- #

m12 &lt;- hglm2(y ~ x1 + x3 + x5 + x6 + (1|Device),
             family = Gamma(link = log),
             disp = ~ x2 + x3, data = semiconductor)
summary(m12)
     
# -------------------------- #
# redo it using matrix input #
# -------------------------- #

attach(semiconductor)
m13 &lt;- hglm(y = y, X = model.matrix(~ x1 + x3 + x5 + x6),
            Z = kronecker(diag(16), rep(1, 4)),
            X.disp = model.matrix(~ x2 + x3), 
            family = Gamma(link = log))
summary(m13)
     
# --------------------- #
# verbose &amp; likelihoods #
# --------------------- #
     
m14 &lt;- hglm(fixed = y ~ x1 + x3 + x5 + x6,
            random = ~ 1|Device,
            family = Gamma(link = log),
            disp = ~ x2 + x3, data = semiconductor,
            verbose = TRUE, calc.like = TRUE)
summary(m14)

# --------------------------------------------- #  
# simulated example with 2 random effects terms #
# --------------------------------------------- #  
## Not run: 
set.seed(911)
x1 &lt;- rnorm(100)
x2 &lt;- rnorm(100)
x3 &lt;- rnorm(100)
z1 &lt;- factor(rep(LETTERS[1:10], rep(10, 10)))
z2 &lt;- factor(rep(letters[1:5], rep(20, 5)))
Z1 &lt;- model.matrix(~ 0 + z1)
Z2 &lt;- model.matrix(~ 0 + z2)
u1 &lt;- rnorm(10, 0, sqrt(2))
u2 &lt;- rnorm(5, 0, sqrt(3))
y &lt;- 1 + 2*x1 + 3*x2 + Z1%*%u1 + Z2%*%u2 + rnorm(100, 0, sqrt(exp(x3)))
dd &lt;- data.frame(x1 = x1, x2 = x2, x3 = x3, z1 = z1, z2 = z2, y = y)

(m21 &lt;- hglm(X = cbind(rep(1, 100), x1, x2), y = y, Z = cbind(Z1, Z2), 
             RandC = c(10, 5)))
summary(m21)
plot(m21)

# m21 is the same as:
(m21b &lt;- hglm(X = cbind(rep(1, 100), x1, x2), y = y, Z = cbind(Z1, Z2), 
              rand.family = list(gaussian(), gaussian()), RandC = c(10, 5))

(m22 &lt;- hglm2(y ~ x1 + x2 + (1|z1) + (1|z2), data = dd, vcovmat = TRUE))
image(m22$vcov, main = 'Variance-covariance Matrix')
summary(m22)
plot(m22)

m31 &lt;- hglm2(y ~ x1 + x2 + (1|z1) + (1|z2), disp = ~ x3, data = dd)
print (m31)
summary(m31)
plot(m31)

# ------------------------------- #  
# Markov random field (MRF) model #
# ------------------------------- #  
data(cancer)
logE &lt;- log(E)
X11 &lt;- model.matrix(~Paff)
m41 &lt;- hglm(X = X11, y = O, Z = diag(length(O)), 
           family = poisson(), rand.family = CAR(D = nbr),
           offset = logE, conv = 1e-9, maxit = 200, fix.disp = 1)
summary(m41)

data(ohio)
m42 &lt;- hglm(fixed = MedianScore ~ 1, 
            random = ~ 1 | district, 
            rand.family = CAR(D = ohioDistrictDistMat), 
            data = ohioMedian)
summary(m42)
require(sp)
districtShape &lt;- as.numeric(substr(as.character(ohioShape@data$UNSDIDFP), 3, 7)) 
CARfit &lt;- matrix(m42$ranef + m42$fixef, dimnames = list(rownames(ohioDistrictDistMat), NULL))
ohioShape@data$CAR &lt;- CARfit[as.character(districtShape),]
ohioShape@data$CAR[353] &lt;- NA # remove estimate of Lake Erie
spplot(ohioShape, zcol = "CAR", main = "Fitted values from CAR", 
        col.regions = heat.colors(1000)[1000:1], cuts = 1000)

## End(Not run)
</code></pre>


</div>
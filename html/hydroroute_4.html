<div class="container">

<table style="width: 100%;"><tr>
<td>get_lag_dir</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Get Lag from Input Directory</h2>

<h3>Description</h3>

<p>Given a file path it reads a data frame (time series)
of measurements. For each <code>relation</code> file in the
provided directory path it calls
<code>get_lag_file()</code>.  Make sure that
the file with Q data and the relation files have the same
separator (<code>inputsep</code>) and character for decimal points
(<code>inputdec</code>). Gauging station ID's in the <code>relation</code>
files have to be in order of their location in downstream
direction. The resulting lags are appended to the relation
files. The resulting list of relation files can be returned and
each relation file can be saved to its input path.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get_lag_dir(
  Q,
  relation,
  steplength = 15,
  lag.max = 20,
  na.action = na.pass,
  tz = "Etc/GMT-1",
  format = "%Y.%m.%d %H:%M",
  cols = c(1, 2, 3),
  inputsep = ",",
  inputdec = ".",
  relation_pattern = "relation",
  save = FALSE,
  mc.cores = getOption("mc.cores", 2L),
  overwrite = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>Data frame or character string. If it is a data frame, it
corresponds to the <code>Q</code> data frame in
<code>get_lag()</code>.  It contains at least a
column with the gauging station ID's (default: column index 1), a
column with date-time values in character representation
(default: column index 2) and a column with flow measurements
(default: column index 3). If the column indices differ from
<code>c(1, 2, 3)</code>, they have to be specified as <code>cols</code>
argument in the format <code>c(i, j, k)</code>. If it is a character
string, it contains the path to the corresponding file which is
then read within the function with
<code>utils::read.csv()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>relation</code></td>
<td>
<p>A character string containing the path to the
directory where the relation files are located. They are read
within the function with
<code>utils::read.csv()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>steplength</code></td>
<td>
<p>Numeric value that specifies the length between
time steps in minutes (default: <code>15</code> minutes). As time
steps have to be equispaced, this is used by
<code>hydropeak::flow()</code> to get a
compatible format and fill missing time steps with <code>NA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lag.max</code></td>
<td>
<p>Maximum lag at which to calculate the ccf in
<code>stats::ccf()</code> (default: <code>20</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>Function to be called to handle missing values in
<code>stats::ccf()</code> (default:
<code>na.pass</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tz</code></td>
<td>
<p>Character string specifying the time zone to be used for
internal conversion (default: <code>Etc/GMT-1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format</code></td>
<td>
<p>Character string giving the date-time format of the
date-time column in the input data frame <code>Q</code>. This is
passed to <code>hydropeak::flow()</code>, to
get a compatible format (default: <code>YYYY.mm.dd HH:MM</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cols</code></td>
<td>
<p>Integer vector specifying column indices in the input
data frame which contain gauging station ID, date-time and flow
rate to be renamed. The default indices are 1 (ID), 2
(date-time) and 3 (flow rate, Q).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputsep</code></td>
<td>
<p>Field separator character string for input data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputdec</code></td>
<td>
<p>Character string for decimal points in input data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>relation_pattern</code></td>
<td>
<p>Character string containing a regular
expression to filter <code>relation</code> files (default: <code>relation</code>, to
filter files that contain <code>relation</code> with no restriction) (see
<code>base::grep()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save</code></td>
<td>
<p>A logical. If <code>FALSE</code> (default) the lag, appended
to the relation file, overwrites the original <code>relation</code>
input file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.cores</code></td>
<td>
<p>Number of cores to use with
<code>parallel::mclapply()</code>. On
Windows, this is set to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>A logical. If <code>FALSE</code> (default), it produces
an error if a <code>LAG</code> column already exists in the
<code>relation</code> file. Otherwise, it overwrites an existing
column.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns invisibly a list of data frames where each list
element represents a <code>relation</code> file from the input
directory. Optionally, the data frames are used to overwrite the existing
<code>relation</code> files with the appended <code>LAG</code> column.
</p>


<h3>Examples</h3>

<pre><code class="language-R">Q_file &lt;- system.file("testdata", "Q.csv", package = "hydroroute")
relations_path &lt;- system.file("testdata", package = "hydroroute")
lag_list &lt;- get_lag_dir(Q_file, relations_path, inputsep = ",",
                        inputdec = ".", format = "%Y-%m-%d %H:%M",
                        overwrite = TRUE)
lag_list
</code></pre>


</div>
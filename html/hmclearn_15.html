<div class="container">

<table style="width: 100%;"><tr>
<td>hmc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit a generic model using Hamiltonian Monte Carlo (HMC)</h2>

<h3>Description</h3>

<p>This function runs the HMC algorithm on a generic model provided
the <code>logPOSTERIOR</code> and gradient <code>glogPOSTERIOR</code> functions.
All parameters specified within the list <code>param</code>are passed to these two functions.
The tuning parameters <code>epsilon</code> and <code>L</code> are passed to the
Leapfrog algorithm.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hmc(
  N = 10000,
  theta.init,
  epsilon = 0.01,
  L = 10,
  logPOSTERIOR,
  glogPOSTERIOR,
  randlength = FALSE,
  Mdiag = NULL,
  constrain = NULL,
  verbose = FALSE,
  varnames = NULL,
  param = list(),
  chains = 1,
  parallel = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>Number of MCMC samples</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.init</code></td>
<td>
<p>Vector of initial values for the parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
<p>Step-size parameter for <code>leapfrog</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>Number of <code>leapfrog</code> steps parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logPOSTERIOR</code></td>
<td>
<p>Function to calculate and return the log posterior given a vector of values of <code>theta</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glogPOSTERIOR</code></td>
<td>
<p>Function to calculate and return the gradient of the log posterior given a vector of values of  <code>theta</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>randlength</code></td>
<td>
<p>Logical to determine whether to apply some randomness to the number of leapfrog steps tuning parameter <code>L</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mdiag</code></td>
<td>
<p>Optional vector of the diagonal of the mass matrix <code>M</code>.  Defaults to unit diagonal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constrain</code></td>
<td>
<p>Optional vector of which parameters in <code>theta</code> accept positive values only.  Default is that all parameters accept all real numbers</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical to determine whether to display the progress of the HMC algorithm</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>Optional vector of theta parameter names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>
<p>List of additional parameters for <code>logPOSTERIOR</code> and <code>glogPOSTERIOR</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chains</code></td>
<td>
<p>Number of MCMC chains to run</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Logical to set whether multiple MCMC chains should be run in parallel</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters for <code>logPOSTERIOR</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Object of class <code>hmclearn</code>
</p>


<h3>Elements for <code>hmclearn</code> objects</h3>


<dl>
<dt><code>N</code></dt>
<dd>
<p>Number of MCMC samples
</p>
</dd>
<dt><code>theta</code></dt>
<dd>
<p>Nested list of length <code>N</code> of the sampled values of <code>theta</code> for each chain
</p>
</dd>
<dt><code>thetaCombined</code></dt>
<dd>
<p>List of dataframes containing sampled values, one for each chain
</p>
</dd>
<dt><code>r</code></dt>
<dd>
<p>List of length <code>N</code> of the sampled momenta
</p>
</dd>
<dt><code>theta.all</code></dt>
<dd>
<p>Nested list of all parameter values of <code>theta</code> sampled prior to accept/reject step for each
</p>
</dd>
<dt><code>r.all</code></dt>
<dd>
<p>List of all values of the momenta <code>r</code> sampled prior to accept/reject
</p>
</dd>
<dt><code>accept</code></dt>
<dd>
<p>Number of accepted proposals.  The ratio <code>accept</code> / <code>N</code> is the acceptance rate
</p>
</dd>
<dt><code>accept_v</code></dt>
<dd>
<p>Vector of length <code>N</code> indicating which samples were accepted
</p>
</dd>
<dt><code>M</code></dt>
<dd>
<p>Mass matrix used in the HMC algorithm
</p>
</dd>
<dt><code>algorithm</code></dt>
<dd>
<p><code>HMC</code> for Hamiltonian Monte Carlo
</p>
</dd>
<dt><code>varnames</code></dt>
<dd>
<p>Optional vector of parameter names
</p>
</dd>
<dt><code>chains</code></dt>
<dd>
<p>Number of MCMC chains
</p>
</dd>
</dl>
<h3>Available <code>logPOSTERIOR</code> and <code>glogPOSTERIOR</code> functions</h3>


<dl>
<dt><code>linear_posterior</code></dt>
<dd>
<p>Linear regression:  log posterior
</p>
</dd>
<dt><code>g_linear_posterior</code></dt>
<dd>
<p>Linear regression:  gradient of the log posterior
</p>
</dd>
<dt><code>logistic_posterior</code></dt>
<dd>
<p>Logistic regression:  log posterior
</p>
</dd>
<dt><code>g_logistic_posterior</code></dt>
<dd>
<p>Logistic regression:  gradient of the log posterior
</p>
</dd>
<dt><code>poisson_posterior</code></dt>
<dd>
<p>Poisson (count) regression:  log posterior
</p>
</dd>
<dt><code>g_poisson_posterior</code></dt>
<dd>
<p>Poisson (count) regression: gradient of the log posterior
</p>
</dd>
<dt><code>lmm_posterior</code></dt>
<dd>
<p>Linear mixed effects model:  log posterior
</p>
</dd>
<dt><code>g_lmm_posterior</code></dt>
<dd>
<p>Linear mixed effects model:  gradient of the log posterior
</p>
</dd>
<dt><code>glmm_bin_posterior</code></dt>
<dd>
<p>Logistic mixed effects model:  log posterior
</p>
</dd>
<dt><code>g_glmm_bin_posterior</code></dt>
<dd>
<p>Logistic mixed effects model:  gradient of the log posterior
</p>
</dd>
<dt><code>glmm_poisson_posterior</code></dt>
<dd>
<p>Poisson mixed effects model:  log posterior
</p>
</dd>
<dt><code>g_glmm_poisson_posterior</code></dt>
<dd>
<p>Poisson mixed effects model:  gradient of the log posterior
</p>
</dd>
</dl>
<h3>Author(s)</h3>

<p>Samuel Thomas <a href="mailto:samthoma@iu.edu">samthoma@iu.edu</a>, Wanzhu Tu <a href="mailto:wtu@iu.edu">wtu@iu.edu</a>
</p>


<h3>References</h3>

<p>Neal, Radford. 2011. <em>MCMC Using Hamiltonian Dynamics.</em> In Handbook of Markov Chain Monte Carlo, edited by Steve Brooks, Andrew Gelman, Galin L. Jones, and Xiao-Li Meng, 116â€“62. Chapman; Hall/CRC.
</p>
<p>Betancourt, Michael. 2017.  <em>A Conceptual Introduction to Hamiltonian Monte Carlo</em>.
</p>
<p>Thomas, S., Tu, W. 2020. <em>Learning Hamiltonian Monte Carlo in R</em>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Linear regression example
set.seed(521)
X &lt;- cbind(1, matrix(rnorm(300), ncol=3))
betavals &lt;- c(0.5, -1, 2, -3)
y &lt;- X%*%betavals + rnorm(100, sd=.2)

fm1_hmc &lt;- hmc(N = 500,
          theta.init = c(rep(0, 4), 1),
          epsilon = 0.01,
          L = 10,
          logPOSTERIOR = linear_posterior,
          glogPOSTERIOR = g_linear_posterior,
          varnames = c(paste0("beta", 0:3), "log_sigma_sq"),
          param=list(y=y, X=X), parallel=FALSE, chains=1)

summary(fm1_hmc, burnin=100)


# poisson regression example
set.seed(7363)
X &lt;- cbind(1, matrix(rnorm(40), ncol=2))
betavals &lt;- c(0.8, -0.5, 1.1)
lmu &lt;- X %*% betavals
y &lt;- sapply(exp(lmu), FUN = rpois, n=1)

fm2_hmc &lt;- hmc(N = 500,
          theta.init = rep(0, 3),
          epsilon = 0.01,
          L = 10,
          logPOSTERIOR = poisson_posterior,
          glogPOSTERIOR = g_poisson_posterior,
          varnames = paste0("beta", 0:2),
          param = list(y=y, X=X),
          parallel=FALSE, chains=1)

summary(fm2_hmc, burnin=100)


</code></pre>


</div>
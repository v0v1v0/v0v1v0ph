<div class="container">

<table style="width: 100%;"><tr>
<td>combinef</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Optimally combine forecasts from a hierarchical or grouped time series</h2>

<h3>Description</h3>

<p>Using the methods of Hyndman et al. (2016) and Hyndman et al. (2011), this function optimally combines
the forecasts at all levels of a hierarchical time series. The
<code>forecast.gts</code> calls this function when the <code>comb</code> method
is selected.
</p>


<h3>Usage</h3>

<pre><code class="language-R">combinef(
  fcasts,
  nodes = NULL,
  groups = NULL,
  weights = NULL,
  nonnegative = FALSE,
  algorithms = c("lu", "cg", "chol", "recursive", "slm"),
  keep = c("gts", "all", "bottom"),
  parallel = FALSE,
  num.cores = 2,
  control.nn = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fcasts</code></td>
<td>
<p>Matrix of forecasts for all levels of the hierarchical time
series. Each row represents one forecast horizon and each column represents
one time series from the hierarchy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodes</code></td>
<td>
<p>If the object class is <code>hts</code>, a list contains the number
of child nodes referring to <code>hts</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>
<p>If the object class is <code>gts</code>, a gmatrix is required,
which is the same as <code>groups</code> in the function <code>gts</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>A numeric vector. The default is <code>NULL</code> which means that
ordinary least squares is implemented.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonnegative</code></td>
<td>
<p>Logical. Should the reconciled forecasts be non-negative?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>algorithms</code></td>
<td>
<p>An algorithm to be used for computing reconciled
forecasts. See <code>forecast.gts</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep</code></td>
<td>
<p>Return a <code>gts</code> object or the the reconciled forecasts at
the bottom level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Logical. Import parallel package to allow parallel processing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num.cores</code></td>
<td>
<p>Numeric. Specify how many cores are going to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control.nn</code></td>
<td>
<p>A list of control parameters to be passed on to the
block principal pivoting algorithm. See 'Details'.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>control.nn</code> argument is a list that can supply any of the following components:
</p>

<dl>
<dt><code>ptype</code></dt>
<dd>
<p>Permutation method to be used: <code>"fixed"</code> or <code>"random"</code>. Defaults to <code>"fixed"</code>.</p>
</dd>
<dt><code>par</code></dt>
<dd>
<p>The number of full exchange rules that may be tried. Defaults to 10.</p>
</dd>
<dt><code>gtol</code></dt>
<dd>
<p>The tolerance of the convergence criteria. Defaults to <code>sqrt(.Machine$double.eps)</code>.</p>
</dd>
</dl>
<h3>Value</h3>

<p>Return the (non-negative) reconciled <code>gts</code> object or forecasts at the bottom
level.
</p>


<h3>Author(s)</h3>

<p>Alan Lee, Rob J Hyndman, Earo Wang and Shanika L Wickramasuriya
</p>


<h3>References</h3>

<p>Hyndman, R. J., Ahmed, R. A., Athanasopoulos, G., &amp; Shang, H. L.
(2011). Optimal combination forecasts for hierarchical time series.
<em>Computational Statistics and Data Analysis</em>, <b>55</b>(9), 2579–2589. <a href="https://robjhyndman.com/publications/hierarchical/">https://robjhyndman.com/publications/hierarchical/</a>
</p>
<p>Hyndman, R. J., Lee, A., &amp; Wang, E. (2016). Fast computation of reconciled
forecasts for hierarchical and grouped time series. <em>Computational Statistics and Data Analysis</em>,
<b>97</b>, 16–32. <a href="https://robjhyndman.com/publications/hgts/">https://robjhyndman.com/publications/hgts/</a>
</p>
<p>Wickramasuriya, S. L., Turlach, B. A., &amp; Hyndman, R. J. (to appear). Optimal non-negative forecast reconciliation.
<em>Statistics and Computing</em>. <a href="https://robjhyndman.com/publications/nnmint/">https://robjhyndman.com/publications/nnmint/</a>
</p>


<h3>See Also</h3>

<p><code>hts</code>, <code>forecast.gts</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# hts example
## Not run: 
h &lt;- 12
ally &lt;- aggts(htseg1)
allf &lt;- matrix(NA, nrow = h, ncol = ncol(ally))
for(i in 1:ncol(ally))
	allf[,i] &lt;- forecast(auto.arima(ally[,i]), h = h)$mean
allf &lt;- ts(allf, start = 51)
y.f &lt;- combinef(allf, get_nodes(htseg1), weights = NULL, keep = "gts", algorithms = "lu")
plot(y.f)

## End(Not run)

## Not run: 
h &lt;- 12
ally &lt;- abs(aggts(htseg2))
allf &lt;- matrix(NA, nrow = h, ncol = ncol(ally))
for(i in 1:ncol(ally))
  allf[,i] &lt;- forecast(auto.arima(ally[,i], lambda = 0, biasadj = TRUE), h = h)$mean
b.f &lt;- combinef(allf, get_nodes(htseg2), weights = NULL, keep = "bottom",
algorithms = "lu")
b.nnf &lt;- combinef(allf, get_nodes(htseg2), weights = NULL, keep = "bottom",
algorithms = "lu", nonnegative = TRUE)

## End(Not run)

# gts example
## Not run: 
abc &lt;- ts(5 + matrix(sort(rnorm(200)), ncol = 4, nrow = 50))
g &lt;- rbind(c(1,1,2,2), c(1,2,1,2))
y &lt;- gts(abc, groups = g)
h &lt;- 12
ally &lt;- aggts(y)
allf &lt;- matrix(NA,nrow = h,ncol = ncol(ally))
for(i in 1:ncol(ally))
  allf[,i] &lt;- forecast(auto.arima(ally[,i]),h = h)$mean
allf &lt;- ts(allf, start = 51)
y.f &lt;- combinef(allf, groups = get_groups(y), keep ="gts", algorithms = "lu")
plot(y.f)

## End(Not run)
</code></pre>


</div>
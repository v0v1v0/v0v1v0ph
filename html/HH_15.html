<div class="container">

<table style="width: 100%;"><tr>
<td>AEdotplot.data.frame</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> AE (Adverse Events) dotplot of incidence and relative risk,
support functions </h2>

<h3>Description</h3>

<p>Support functions for the <code>AEdotplot</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  ## S3 method for class 'data.frame'
AEdotplot(xr, ...,
          conditionVariable=NULL,
          conditionName=deparse(substitute(xr)),
          useCondition=!is.null(conditionVariable),
          sub=list(conditionName, cex=.7))

  ## S3 method for class 'AElogrelrisk'
AEdotplot(xr,
          A.name=paste(levels(xr$RAND)[1], " (n=", xr$SN[1], ")", sep=""),
          B.name=paste(levels(xr$RAND)[2], " (n=", xr$SN[2], ")", sep=""),
          col.AB=c("red","blue"), pch.AB=c(16,17),
           main=if (sortbyRelativeRisk)
              list("Most Frequent On-Therapy Adverse Events Sorted by Relative Risk",
                   cex=1)
           else
              list("Most Frequent On-Therapy Adverse Events", cex=1),
          cex.AB.points=NULL, cex.AB.y.scale=.6, cex.x.scale=.6,
          panel.widths=c(.55, .22, .23),
          key.y=-.2, CI.percent=95,
          conditionName=deparse(substitute(xr)),
          sortbyRelativeRisk=TRUE,
          ...,
          sub=list(conditionName, cex=.7),
          par.strip.text=list(cex=.7))

  ## S3 method for class 'AEtable'
AEdotplot(xr, ..., useCondition=TRUE,
                              sub="sub for AEsecond")

  ## S3 method for class 'AEdotplot'
print(x, ...,
      main=attr(x, "main"),
      sub=attr(x,"sub"),
      ae.key=attr(x, "ae.key"),
      panel.widths=attr(x,"panel.widths"),
      AEtable=TRUE)

  ## S3 method for class 'AEdotplot'
c(..., panel.widths=attr(aedp[[1]], "panel.widths"),
                        par.strip.text=list(cex=.7))

  AElogrelrisk(ae,
               A.name=levels(ae$RAND)[1],
               B.name=levels(ae$RAND)[2],
               crit.value=1.96,
               sortbyRelativeRisk=TRUE, ...,
                         sortbyVar=c("PREF", ## Event name
                           "PCT",            ## Percent
                           "SN",             ## Number of Patients
                           "SAE",            ## Number of Observed Events
                           "relrisk",        ## Relative Risk (RR)
                           "ase.logrelrisk", ## Asymptotic Standard Error(log(RR))
                           "relriskCI.lower", ## Confidence Interval Bounds
                           "relriskCI.upper"),
                         sortbyVarBegin=1)   ## 1 for A treatment, 2 for B treatment

  AEmatchSortorder(AEstandard,
                   AEsecond,
                   AEsecond.AEtable=attr(AEsecond, "AEtable"),
                   levels.order=
                      lapply(attr(AEstandard,"AEtable"),
                             function(AEsubtable) levels(AEsubtable$PREF)),
                   main.second=list(paste("Most Frequent On-Therapy Adverse Events",
                                          "Sorted to Match First Table"),
                                    cex=1))

  ## S3 method for class 'AEdotplot'
update(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ae</code></td>
<td>
<p>For <code>AElogrelrisk</code>, a data.frame containing at least the
first 4 columns of <code>xr</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xr</code></td>
<td>
<p>For the formula method documented in
<code>AEdotplot</code>, a formula of the form<br><code>AE ~ nAE/nTRT | OrgSys</code>, where the condition variable is
optional.
For the formula method only, the variable names are not restricted.
</p>
<p>For the other methods, <code>xr</code> is a <code>data.frame</code> containing the Adverse
Event data in long format. It must have variables named<br><code>RAND</code>:   treatment as randomized (factor with exactly two levels).<br><code>PREF</code>:   adverse event symptom name (factor).<br><code>SN</code>:     number of patients in treatment group.<br><code>SAE</code>:    number of patients in each group for whom the event
PREF was observed.
</p>
<p>If the <code>xr</code> object is a <code>AElogrelrisk</code> object, then it must
also have variables<br><code>PCT</code>: <code>SAE</code>/<code>SN</code> as a percent.<br><code>relrisk</code>: Relative risk defined as <code>PCT</code> for the B
treatment divided by <code>PCT</code> for the A treatment.<br><code>logrelrisk</code>: natural logarithm of <code>relrisk</code>.<br><code>ase.logrelrisk</code>: asymptotic standard error of <code>logrelrisk</code>.<br><code>logrelriskCI.lower, logrelriskCI.upper</code>: confidence interval for
<code>logrelrisk</code>.<br><code>relriskCI.lower, relriskCI.upper</code>: back transform of the CI for
the log relative risk into the relative risk scale.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortbyRelativeRisk</code></td>
<td>
<p>logical.  If <code>TRUE</code>, then make the
Adverse Events an ordered factor ordering by relative risk.
If <code>FALSE</code>, then make the
Adverse Events an ordered factor retaining the order of the input levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditionVariable</code></td>
<td>
<p>Vector of same length as number of rows in
<code>xr</code>, it may be one of the columns in <code>xr</code> in which case
its full name in the form xr$varname must be used.  It will be used to
split the <code>data.frame</code> into partitions.
It may be used to partition the plot,
for example by organ system or by gender.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditionName</code></td>
<td>
<p>Character. Name to be used in <code>left.strip</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useCondition</code></td>
<td>
<p>logical.  If <code>FALSE</code>, then a non-<code>NULL</code>
<code>ConditionVariable</code> won't be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>object to be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>panel.widths</code></td>
<td>
<p>Vector of three non-negative numerics that sum to 1.
These are the widths of each of the three panels in the output plot.
The left panel contains the AE names as y-tick labels and the Percent plot.
The middle panel contains the Relative Risk plot.
The right panel contains a table of the numerical values of number of patients
for each treatment,
number of adverse events for each treatment, and relative risk.
Setting the third value to 0 suppresses the table of numerical
values from the display.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AEtable</code></td>
<td>
<p>logical.  For the <code>print.AEdotplot</code> function.
If <code>TRUE</code> (the default), display all three panels.  If
<code>FALSE</code>, then display only the Percent and Relative Risk plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main, sub</code></td>
<td>
<p>Main title and subtitle for the combined plot
in <code>AEdotplot</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main.second</code></td>
<td>
<p>Main title for second plot whose sort order has
been changed to match the first plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A.name, B.name</code></td>
<td>
<p>Names of treatment groups (in <code>x$RAND</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.AB, pch.AB, cex.AB.points</code></td>
<td>
<p>color, plotting character and
character expansion for the individual points on the left plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.AB.y.scale</code></td>
<td>
<p>Character expansion for the left tick labels
(the Adverse Effects names). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.x.scale</code></td>
<td>
<p>Character expansion for the x-axis tick labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key.y</code></td>
<td>
<p>Position of the key (legend) in the combined plot.  This
is the <code>y</code> argument of the <code>key</code>.
See the discussion of the <code>key</code> argument to <code>xyplot</code> in
<code>xyplot</code></p>
</td>
</tr>
</table>
<p>.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>ae.key</code></td>
<td>
<p>is a key as described in <code>xyplot</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AEstandard, AEsecond, AEsecond.AEtable, levels.order</code></td>
<td>
<p>Arguments
that force the Adverse Events in the panels of <code>AEsecond</code> to
have the same sort order <code>levels.order</code> of <code>PREF</code> as the
panels of <code>AEstandard</code>. <code>AEstandard</code> and <code>AEsecond</code>
are two <code>"AEdotplot"</code> objects with the same set of panels and
the same Adverse Events in corresponding panels.
<code>AEsecond.AEtable</code> is the <code>AEtable</code> object from
<code>AEsecond</code>.  <code>levels.order</code> is the new order for
<code>AEsecond</code>; normally the same order as in <code>AEprimary</code>.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crit.value</code></td>
<td>
<p>Critical value used to compute confidence intervals
on the log relative risk.  Defaults to 1.96.  User is responsible
for specifying both <code>crit.value</code> and <code>CI.percent</code>
consistently.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI.percent</code></td>
<td>
<p>Confidence percent associated with the
<code>crit.value</code> Defaults to 95.  User is responsible for
specifying both <code>crit.value</code> and <code>CI.percent</code>
consistently.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>For <code>AEdotplot</code> and <code>AEdotplot.data.frame</code>,
all the arguments listed in the
calling sequence for <code>AEddotplot.AErelrisk</code>..
For <code>c.AEdotplot</code>, one or more <code>"AEdotplot"</code> objects.
For <code>print.AEdotplot</code>, the <code>...</code> arguments are ignored.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortbyVar</code></td>
<td>

<p>Specify which variable will be used to provide the sort order in the
plot.
The names are the internal names for the variables.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortbyVarBegin</code></td>
<td>

<p>1 for A treatment, 2 for B treatment.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An <code>AEdotplot</code> object.  The <code>update</code> method
updates the components of each of the constituent <code>trellis</code>
objects.  It does not update the <code>"main"</code> and <code>"sub"</code>
attributes (nor any other attribute) of the <code>AEdotplot</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.strip.text</code></td>
<td>
<p>Default value for strip labels.  See
<code>xyplot</code>
for details.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The first panel is an ordinary dotplot of the percent of AE observed for each
treatment by AE.
</p>
<p>The second panel shows relative risk of an event on the Treatment B arm
(usually the active compound)
relative to the Treatment A arm (usually the placebo), with 95% confidence
intervals for a <code class="reqn">2\times2</code> table.  Confidence intervals on the log
relative risk are calculated using the asymptotic standard error
formula given as Equation 3.18 in Agresti A., <em>Categorical Data
Analysis.</em> Wiley: New York, 1990.
</p>
<p>By default the <code>AEdotplot</code> function sorts the events by relative risk.
To retain the sort order implied by the <code>levels</code> of the AE
factor, specify the argument <code>sortbyRelativeRisk=FALSE</code>.
To control the sort order, make the AE factor in the input dataset
an <code>ordered</code> factor
and specify the levels in the order you want.
</p>
<p>The third panel shows the numerical values of the number and percent
of observed events on each arm and the relative risk.
The display of third panel can be suppressed by specifying the
<code>panel.widths</code> argument.
</p>


<h3>Value</h3>

<p>The primary interest is in the display of the plot.
</p>
<p>The function returns
an <code>AEdotplot</code> object which is a list of three <code>trellis</code>
objects,
one for the the Percent plot, one for the Relative Risk plot, and one
for
the Text plot containing the table of input values.  The object has
attributes
</p>

<ol>
<li> <p><code>main</code> and <code>sub</code> hold the main and subtitles.  Each must
be a list containing the text in the first component.
</p>
</li>
<li> <p><code>ae.key</code> is a key as described in
<code>xyplot</code>.
</p>
</li>
<li> <p><code>n.events</code> is a vector containing the number of events in
each subpanel.
</p>
</li>
<li> <p><code>panel.widths</code> is a vector of relative widths of the three components
of
the graph.  The numbers must sum to one.  Zero values are permitted.
The first width includes the left axis and the Percent plot.  The second
is the Relative Risk plot, and the third is the plot of the table
values.
</p>
</li>
<li> <p><code>AEtable</code> is a table containing the data plotted on its row.
</p>
</li>
</ol>
<h3>Author(s)</h3>

<p> Richard M. Heiberger &lt;rmh@temple.edu&gt; </p>


<h3>References</h3>

<p>Ohad Amit, Richard M. Heiberger, and Peter W. Lane. (2008)
“Graphical Approaches to the Analysis of Safety Data from Clinical Trials”.
<em>Pharmaceutical Statistics</em>,
<b>7</b>, 1, 20–35.

<a href="https://onlinelibrary.wiley.com/doi/10.1002/pst.254">https://onlinelibrary.wiley.com/doi/10.1002/pst.254</a>


</p>


<h3>See Also</h3>

<p><code>AEdotplot</code></p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
## variable names in the input data.frame aeanonym
## RAND   treatment as randomized
## PREF   adverse event symptom name
## SN     number of patients in treatment group
## SAE    number of patients  in each group for whom the event PREF was observed
## OrgSys Organ System
##
## Input sort order is PREF/RAND

data(aeanonym)
head(aeanonym)

## variable names are hard-wired in the program
## names(aeanonym) &lt;- c("RAND", "PREF", "SAE", "SN", "OrgSys")


## Calculate log relative risk and confidence intervals (95
## AElogrelrisk sets the sort order for PREF to match the relative risk.
aeanonymr &lt;- AElogrelrisk(aeanonym) ## PREF sorted by relative risk
head(aeanonymr)
class(aeanonymr$PREF)
levels(aeanonymr$PREF)

AEdotplot(aeanonym)

AEdotplot(aeanonym, sort=FALSE)

AEdotplot(aeanonym, conditionVariable=aeanonym$OrgSys)

aefake &lt;- rbind(cbind(aeanonym, group="ABC"), cbind(aeanonym, group="DEF"))
aefake$SAE[67:132] &lt;- sample(aefake$SAE[67:132])
aefake$OrgSys.group &lt;- with(aefake, interaction(OrgSys, group))

## fake 2
KEEP &lt;- aefake$OrgSys %in% c("GI","Resp")

AEfakeGR &lt;- AEdotplot(aefake[KEEP,], conditionVariable=aefake$OrgSys.group[KEEP],
            sub=list("ABC and DEF have different sort orders for PREF", cex=.7))
AEfakeGR ## ABC and DEF have different sort orders for PREF

AEfakeGR1 &lt;- AEdotplot(aefake[KEEP &amp; (1:132) &lt;= 66,],
                       conditionVariable=aefake$OrgSys.group[KEEP &amp; (1:132) &lt;= 66])
AEfakeGR2 &lt;- AEdotplot(aefake[KEEP &amp; (1:132) &gt;= 67,],
                       conditionVariable=aefake$OrgSys.group[KEEP &amp; (1:132) &gt;= 67])

AEfakeGR1
AEfakeGR2

AEfakeMatched &lt;- AEmatchSortorder(AEfakeGR1, AEfakeGR2)
update(do.call(c, AEfakeMatched),
       main="ABC sorted by Relative Risk; DEF matches ABC order")

## End(Not run)
## Please see  ?AEdotplot  for examples using the formula method
##
## Many more examples are in demo("AEdotplotManyExamples")
</code></pre>


</div>
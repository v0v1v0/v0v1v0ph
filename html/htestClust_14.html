<div class="container">

<table style="width: 100%;"><tr>
<td>proptestClust</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Test of Marginal Proportion for Clustered Data</h2>

<h3>Description</h3>

<p><code>proptestClust</code> can be used for testing the null that the marginal proportion
(probability of success) is equal to certain given values in clustered data with potentially informative
cluster size.
</p>


<h3>Usage</h3>

<pre><code class="language-R">proptestClust(x, id, p = NULL, alternative = c("two.sided", "less", "greater"),
             variance = c("sand.null", "sand.est", "emp", "MoM"), conf.level = 0.95)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a vector of binary indicators denoting success/failure of each observation, or a two-dimensional table
(or matrix) with 2 columns giving the aggregate counts of failures and successes (respectively) across clusters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>a vector which identifies the clusters; ignored if <code>x</code> is a matrix or table.
The length of <code>id</code> must be the same as the length of <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>the null hypothesized value of the marginal proportion. Must be a single number greater than 0 and less
than 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>a character string specifying the alternative hypothesis. Must be one of "<code>two.sided</code>",
"<code>greater</code>", or "<code>less</code>". You can specify just the initial letter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance</code></td>
<td>
<p>character string specifying the method of variance estimation. Must be one of "<code>sand.null</code>",
"<code>sand.est</code>", "<code>emp</code>", or "<code>MoM</code>".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>confidence level of the returned confidence interval. Must be a single number between
0 and 1.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>p</code> is not given, the null tested is that the underlying marginal probability of
success is .5.
</p>
<p>The <code>variance</code> argument allows the user to specify the method of variance estimation, selecting from
the sandwich estimate evaluated at the null hypothesis (<code>sand.null</code>), the sandwich estimate evaluated at the
cluster-weighted proportion (<code>sand.est</code>), the empirical estimate (<code>emp</code>), or the method of moments
estimate (<code>MoM</code>).
</p>


<h3>Value</h3>

<p>A list with class "<code>htest</code>" containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>the value of the test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value</code></td>
<td>
<p>the p-value of the test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate</code></td>
<td>
<p>the estimated marginal proportion.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null.value</code></td>
<td>
<p>the value of <code>p</code> under the null hypothesis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>
<p>a confidence interval for the true marginal proportion.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>a character string describing the alternative hypothesis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string indicating the test performed and method of variance estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.name</code></td>
<td>
<p>a character string giving the name of the data and the total number of clusters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>the number of clusters.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Gregg, M., Datta, S., Lorenz, D. (2020) Variance Estimation in Tests of Clustered Categorical Data
with Informative Cluster Size.
<em>Statistical Methods in Medical Research</em>, doi:10.1177/0962280220928572.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(screen8)
## using vectors
## suppose math proficiency is determined by score &gt;= 65
## is the marginal proportion of students proficient in math at least 75%?
screen8$math.p &lt;- 1*(screen8$math&gt;=65)
proptestClust(screen8$math.p, screen8$sch.id, p = .75, alternative = "great")

## using table and empirical variance; two-sided CI
## (note that "failure" counts are the first column and "success" counts are the second column)
mathp.tab &lt;- table(screen8$sch.id, screen8$math.p)
proptestClust(mathp.tab, variance="emp", p=.75)

## when all clusters have a size of 1, results will be in general correspondence with
## that of the classical analogue test
set.seed(123)
x &lt;- rbinom(100, size = 1, p = 0.7)
id &lt;- 1:100
proptestClust(x, id)
prop.test(sum(x), length(x))

</code></pre>


</div>
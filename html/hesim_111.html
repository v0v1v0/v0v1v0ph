<div class="container">

<table style="width: 100%;"><tr>
<td>IndivCtstmTrans</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Transitions for an individual-level continuous time state transition model</h2>

<h3>Description</h3>

<p>Simulate health state transitions in an individual-level continuous time state
transition model using parameters from a multi-state model.
</p>


<h3>Format</h3>

<p>An R6::R6Class object.
</p>


<h3>Super class</h3>

<p><code>hesim::CtstmTrans</code> -&gt; <code>IndivCtstmTrans</code>
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>params</code></dt>
<dd>
<p>An object of class <code>params_surv</code> or <code>params_surv_list</code>.</p>
</dd>
<dt><code>input_data</code></dt>
<dd>
<p>Input data used to simulate health state transitions
by sample from the probabilistic sensitivity analysis (PSA), treatment strategy and patient.
Must be an object of class <code>input_mats</code>. If <code>params</code> contains parameters from
a list of models (i.e., of class <code>params_surv_list</code>), then <code>input_data</code>
must contain a unique row for each treatment strategy
and patient; if <code>params</code> contains parameters from a joint model
(i.e., of class <code>params_surv</code>), then <code>input_data</code> must contain a unique
row for each treatment strategy, patient, and transition.</p>
</dd>
<dt><code>trans_mat</code></dt>
<dd>
<p>A transition matrix describing the states and transitions
in a multi-state model in the format from the <code>mstate</code> package.
See the documentation for the argument <code>"trans"</code> in <code>mstate::msprep</code>.</p>
</dd>
<dt><code>start_state</code></dt>
<dd>
<p>A scalar or vector denoting the starting health state.
Default is the first health state. If a vector, must be equal to the number of simulated patients.</p>
</dd>
<dt><code>start_age</code></dt>
<dd>
<p>A scalar or vector denoting the starting age of each patient
in the simulation. Default is 38. If a vector, must be equal to the number of simulated patients.</p>
</dd>
<dt><code>death_state</code></dt>
<dd>
<p>The death state in <code>trans_mat</code>. Used with <code>max_age</code>
in <code>sim_disease</code> as patients transition to this state upon reaching maximum age.
By default, it is set to the final absorbing state (i.e., a row in <code>trans_mat</code> with all NAs).</p>
</dd>
<dt><code>clock</code></dt>
<dd>
<p>"reset" for a clock-reset model, "forward" for a clock-forward model,
"mix" for a mixture of clock-reset and clock-forward models by state, and
"mixt" for a mixture of clock-reset and clock-forward models by transition. A clock-reset model
is a semi-Markov model in which transition rates depend on time since entering a state.
A clock-forward model is a Markov model in which transition rates depend on time
since entering the initial state. If <code>"mix"</code> is used, then
<code>reset_states</code> must be specified. If <code>"mixt"</code> is used, then <code>transition_types</code> must
be specified.</p>
</dd>
<dt><code>reset_states</code></dt>
<dd>
<p>A vector denoting the states in which time resets.
Hazard functions are always a function of elapsed time since either the
start of the model or from when time was previously reset. Only used if
<code>clock = "mix"</code>.</p>
</dd>
<dt><code>transition_types</code></dt>
<dd>
<p>A vector denoting the type of transition.
The vector is of the same length as the number of transitions
and takes values <code>"reset"</code>, <code>"time"</code> or <code>"age"</code> for hazards that are functions of
reset time, time since study entry or age, respectively. Only used if
<code>clock = "mixt"</code>.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-IndivCtstmTrans-new"><code>IndivCtstmTrans$new()</code></a>
</p>
</li>
<li> <p><a href="#method-IndivCtstmTrans-sim_disease"><code>IndivCtstmTrans$sim_disease()</code></a>
</p>
</li>
<li> <p><a href="#method-IndivCtstmTrans-sim_stateprobs"><code>IndivCtstmTrans$sim_stateprobs()</code></a>
</p>
</li>
<li> <p><a href="#method-IndivCtstmTrans-check"><code>IndivCtstmTrans$check()</code></a>
</p>
</li>
<li> <p><a href="#method-IndivCtstmTrans-clone"><code>IndivCtstmTrans$clone()</code></a>
</p>
</li>
</ul>
<details open><summary>Inherited methods</summary><ul>
<li><span class="pkg-link" data-pkg="hesim" data-topic="CtstmTrans" data-id="cumhazard"><a href="../../hesim/html/CtstmTrans.html#method-CtstmTrans-cumhazard"><code>hesim::CtstmTrans$cumhazard()</code></a></span></li>
<li><span class="pkg-link" data-pkg="hesim" data-topic="CtstmTrans" data-id="hazard"><a href="../../hesim/html/CtstmTrans.html#method-CtstmTrans-hazard"><code>hesim::CtstmTrans$hazard()</code></a></span></li>
</ul></details><hr>
<a id="method-IndivCtstmTrans-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Create a new <code>IndivCtstmTrans</code> object.
</p>


<h5>Usage</h5>

<div class="r"><pre>IndivCtstmTrans$new(
  params,
  input_data,
  trans_mat,
  start_state = 1,
  start_age = 38,
  death_state = NULL,
  clock = c("reset", "forward", "mix", "mixt"),
  reset_states = NULL,
  transition_types = NULL
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>params</code></dt>
<dd>
<p>The <code>params</code> field.</p>
</dd>
<dt><code>input_data</code></dt>
<dd>
<p>The <code>input_data</code> field.</p>
</dd>
<dt><code>trans_mat</code></dt>
<dd>
<p>The <code>trans_mat</code> field.</p>
</dd>
<dt><code>start_state</code></dt>
<dd>
<p>The <code>start_state</code> field.</p>
</dd>
<dt><code>start_age</code></dt>
<dd>
<p>The <code>start_age</code> field.</p>
</dd>
<dt><code>death_state</code></dt>
<dd>
<p>The <code>death_state</code> field.</p>
</dd>
<dt><code>clock</code></dt>
<dd>
<p>The <code>clock</code> field.</p>
</dd>
<dt><code>reset_states</code></dt>
<dd>
<p>The <code>reset_states</code> field.</p>
</dd>
<dt><code>transition_types</code></dt>
<dd>
<p>The <code>transition_types</code> field.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>A new <code>IndivCtstmTrans</code> object.
</p>


<hr>
<a id="method-IndivCtstmTrans-sim_disease"></a>



<h4>Method <code>sim_disease()</code>
</h4>

<p>Simulate disease progression (i.e., individual trajectories through a
multi-state model using an individual patient simulation).
</p>


<h5>Usage</h5>

<div class="r"><pre>IndivCtstmTrans$sim_disease(max_t = 100, max_age = 100, progress = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>max_t</code></dt>
<dd>
<p>A scalar or vector denoting the length of time to simulate the model.
If a vector, must be equal to the number of simulated patients.</p>
</dd>
<dt><code>max_age</code></dt>
<dd>
<p>A scalar or vector denoting the maximum age to simulate
each patient until. If a vector, must be equal to the number of simulated patients.</p>
</dd>
<dt><code>progress</code></dt>
<dd>
<p>An integer, specifying the PSA iteration (i.e., sample) that
should be printed every progress PSA iterations. For example, if progress = 2,
then every second PSA iteration is printed. Default is NULL, in which case
no output is printed.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>An object of class <code>disprog</code>.
</p>


<hr>
<a id="method-IndivCtstmTrans-sim_stateprobs"></a>



<h4>Method <code>sim_stateprobs()</code>
</h4>

<p>Simulate health state probabilities from a disprog object.
</p>


<h5>Usage</h5>

<div class="r"><pre>IndivCtstmTrans$sim_stateprobs(t, disprog = NULL, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>t</code></dt>
<dd>
<p>A numeric vector of times.</p>
</dd>
<dt><code>disprog</code></dt>
<dd>
<p>A disprog object. If
<code>NULL</code>, then this will be simulated prior to computing state probabilities
using <code>IndivCtstm$sim_disease()</code>.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to pass to <code>IndivCtstm$sim_disease()</code> if
<code>disprog = NULL</code>.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>An object of class <code>stateprobs</code>.
</p>


<hr>
<a id="method-IndivCtstmTrans-check"></a>



<h4>Method <code>check()</code>
</h4>

<p>Input validation for class. Checks that fields are the correct type.
</p>


<h5>Usage</h5>

<div class="r"><pre>IndivCtstmTrans$check()</pre></div>


<hr>
<a id="method-IndivCtstmTrans-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>IndivCtstmTrans$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>See Also</h3>

<p><code>IndivCtstmTrans</code> objects are conveniently created from either
fitted models or parameter objects with <code>create_IndivCtstmTrans()</code>.
A complete economic model can be implemented with the <code>IndivCtstm</code> class.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library("flexsurv")

# Simulation data
strategies &lt;- data.frame(strategy_id = c(1, 2, 3))
patients &lt;- data.frame(patient_id = seq(1, 3),
                       age = c(45, 50, 60),
                       female = c(0, 0, 1))

# Multi-state model with transition specific models
tmat &lt;- rbind(c(NA, 1, 2),
              c(NA, NA, 3),
              c(NA, NA, NA))
fits &lt;- vector(length = max(tmat, na.rm = TRUE), mode = "list")
for (i in 1:length(fits)){
  fits[[i]] &lt;- flexsurvreg(Surv(years, status) ~ 1,
                           data = bosms3[bosms3$trans == i, ],
                           dist = "exp")
}
fits &lt;- flexsurvreg_list(fits)

# Simulation model
hesim_dat &lt;- hesim_data(strategies = strategies,
                        patients = patients)
fits_data &lt;- expand(hesim_dat)
transmod &lt;- create_IndivCtstmTrans(fits, input_data = fits_data,
                                   trans_mat = tmat,
                                   n = 2)
head(transmod$hazard(c(1, 2, 3)))
head(transmod$cumhazard(c(1, 2, 3)))

## Simulate disease progression and state probabilities together
transmod$sim_stateprobs(t = c(0, 5, 10))[t == 5]

## Simulate disease progression and state probabilities separately
disprog &lt;- transmod$sim_disease(max_t = 10)
transmod$sim_stateprobs(t = c(0, 5, 10), disprog = disprog)[t == 5]
</code></pre>


</div>
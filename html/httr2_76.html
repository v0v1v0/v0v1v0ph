<div class="container">

<table style="width: 100%;"><tr>
<td>req_perform_stream</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perform a request and handle data as it streams back</h2>

<h3>Description</h3>

<p>After preparing a request, call <code>req_perform_stream()</code> to perform the request
and handle the result with a streaming callback. This is useful for
streaming HTTP APIs where potentially the stream never ends.
</p>
<p>The <code>callback</code> will only be called if the result is successful. If you need
to stream an error response, you can use <code>req_error()</code> to suppress error
handling so that the body is streamed to you.
</p>


<h3>Usage</h3>

<pre><code class="language-R">req_perform_stream(
  req,
  callback,
  timeout_sec = Inf,
  buffer_kb = 64,
  round = c("byte", "line")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>req</code></td>
<td>
<p>A httr2 request object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>callback</code></td>
<td>
<p>A single argument callback function. It will be called
repeatedly with a raw vector whenever there is at least <code>buffer_kb</code>
worth of data to process. It must return <code>TRUE</code> to continue streaming.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeout_sec</code></td>
<td>
<p>Number of seconds to process stream for.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffer_kb</code></td>
<td>
<p>Buffer size, in kilobytes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>round</code></td>
<td>
<p>How should the raw vector sent to <code>callback</code> be rounded?
Choose <code>"byte"</code>, <code>"line"</code>, or supply your own function that takes a
raw vector of <code>bytes</code> and returns the locations of possible cut points
(or <code>integer()</code> if there are none).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An HTTP response. The body will be empty if the request was
successful (since the <code>callback</code> function will have handled it). The body
will contain the HTTP response body if the request was unsuccessful.
</p>


<h3>Examples</h3>

<pre><code class="language-R">show_bytes &lt;- function(x) {
  cat("Got ", length(x), " bytes\n", sep = "")
  TRUE
}
resp &lt;- request(example_url()) |&gt;
  req_url_path("/stream-bytes/100000") |&gt;
  req_perform_stream(show_bytes, buffer_kb = 32)
resp
</code></pre>


</div>
<div class="container">

<table style="width: 100%;"><tr>
<td>applyBiasFactor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Apply bias factor to different forecasts for multi/operational/real time bias correction.</h2>

<h3>Description</h3>

<p>When you do multi/operational/real time bias correction. It's too expensive
to input hindcast and obs every time. Especially when you have a long period of hindcast
and obs, but only a short period of frc, it's too unecessary to read and compute hindcast
and obs everytime. Therefore, biasFactor is designed. Using <code>getBiasFactor</code>, you can
get the biasFactor with hindcast and observation, then you can use <code>applyBiasFactor</code> to 
apply the biasFactor to different forecasts.
</p>


<h3>Usage</h3>

<pre><code class="language-R">applyBiasFactor(frc, biasFactor, obs = NULL)

## S4 method for signature 'data.frame,biasFactor'
applyBiasFactor(frc, biasFactor, obs = NULL)

## S4 method for signature 'list,biasFactor.hyfo'
applyBiasFactor(frc, biasFactor, obs = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>frc</code></td>
<td>
<p>a hyfo grid data output or a dataframe(time series) consists of Date column and one or more value columns, 
representing the frc data. Check details for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>biasFactor</code></td>
<td>
<p>a file containing all the information of the calibration, will be
applied to different forecasts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs</code></td>
<td>
<p>for some methods, observation input is necessary. obs is a hyfo grid data output or a dataframe (time series) consists of Date column and one or more value columns, 
representing the observation data. Default value is NULL.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Information about the method and how biasCorrect works can be found in <code>biasCorrect</code>
</p>
<p><strong>why use biasFactor</strong>
</p>
<p>As for forecasting, for daily data, there is usually no need to have
different bias factor every different day. You can calculate one bisa factor using a long
period of hindcast and obs, and apply that factor to different frc.
</p>
<p>For example,
</p>
<p>You have 10 years of hindcast and observation. you want to do bias correction for some 
forecasting product, e.g. system 4. For system 4, each month, you will get a new forecast
about the future 6 months. So if you want to do the real time bias correction, you have to
take the 10 years of hindcast and observation data with you, and run <code>biasCorrect</code> every
time you get a new forecast. That's too expensive.
</p>
<p>For some practical use in forecasting, there isn't a so high demand for accuracy. E.g.,
Maybe for February and March, you can use the same biasFactor, no need to do the computation 
again. 
</p>
<p>It is a generic function, if in your case you need to debug, please see <code>?debug()</code> 
for how to debug S4 method.
</p>


<h3>Author(s)</h3>

<p>Yuanchao Xu <a href="mailto:xuyuanchao37@gmail.com">xuyuanchao37@gmail.com</a>
</p>


<h3>References</h3>

<p>Bias correction methods come from <code>biasCorrection</code> from <code>dowscaleR</code>
</p>

<ul>
<li>
<p> Santander Meteorology Group (2015). downscaleR: Climate data manipulation and statistical downscaling. R
package version 0.6-0. https://github.com/SantanderMetGroup/downscaleR/wiki
</p>
</li>
<li>
<p> R.A.I. Wilcke, T. Mendlik and A. Gobiet (2013) Multi-variable error correction of regional climate models. Climatic Change, 120, 871-887
</p>
</li>
<li>
<p> A. Amengual, V. Homar, R. Romero, S. Alonso, and C. Ramis (2012) A Statistical Adjustment of Regional Climate Model Outputs to Local Scales: Application to Platja de Palma, Spain. J. Clim., 25, 939-957
</p>
</li>
<li>
<p> C. Piani, J. O. Haerter and E. Coppola (2009) Statistical bias correction for daily precipitation in regional climate models over Europe, Theoretical and Applied Climatology, 99, 187-192
</p>
</li>
<li>
<p> O. Gutjahr and G. Heinemann (2013) Comparing precipitation bias correction methods for high-resolution regional climate simulations using COSMO-CLM, Theoretical and Applied Climatology, 114, 511-529
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>biasCorrect</code> for method used in bias correction. 
<code>getBiasFactor</code>, for the first part.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
######## hyfo grid file biascorrection
########

# If your input is obtained by \code{loadNcdf}, you can also directly biascorrect
# the file.

# First load ncdf file.
filePath &lt;- system.file("extdata", "tnc.nc", package = "hyfo")
varname &lt;- getNcdfVar(filePath)    
nc &lt;- loadNcdf(filePath, varname)

data(tgridData)
#' # Since the example data, has some NA values, the process will include some warning #message, 
# which can be ignored in this case.



# Then we will use nc data as forecasting data, and use itself as hindcast data,
# use tgridData as observation.

biasFactor &lt;- getBiasFactor(nc, tgridData)
newFrc &lt;- applyBiasFactor(nc, biasFactor)
   
biasFactor &lt;- getBiasFactor(nc, tgridData, method = 'eqm', extrapolate = 'constant',
preci = TRUE)
# This method needs obs input.
newFrc &lt;- applyBiasFactor(nc, biasFactor, obs = tgridData)

biasFactor &lt;- getBiasFactor(nc, tgridData, method = 'gqm', preci = TRUE)
newFrc &lt;- applyBiasFactor(nc, biasFactor) 


######## Time series biascorrection
########

# Use the time series from testdl as an example, we take frc, hindcast and obs from testdl.
data(testdl)

# common period has to be extracted in order to better train the forecast.

datalist &lt;- extractPeriod(testdl, startDate = '1994-1-1', endDate = '1995-10-1')

frc &lt;- datalist[[1]]
hindcast &lt;- datalist[[2]]
obs &lt;- datalist[[3]]


# The data used here is just for example, so there could be negative data.

# default method is scaling
biasFactor &lt;- getBiasFactor(hindcast, obs)
frc_new &lt;- applyBiasFactor(frc, biasFactor)

# for precipitation data, extra process needs to be executed, so you have to tell
# the program to it is a precipitation data.

biasFactor &lt;- getBiasFactor(hindcast, obs, preci = TRUE)
frc_new1 &lt;- applyBiasFactor(frc, biasFactor)

# You can use other methods to biascorrect, e.g. delta method. 
biasFactor &lt;- getBiasFactor(hindcast, obs, method = 'delta')
# delta method needs obs input.
frc_new2 &lt;- applyBiasFactor(frc, biasFactor, obs = obs)

# 
biasFactor &lt;- getBiasFactor(hindcast, obs, method = 'eqm', preci = TRUE)
# eqm needs obs input
frc_new3 &lt;- applyBiasFactor(frc, biasFactor, obs = obs)

biasFactor &lt;- getBiasFactor(hindcast, obs, method = 'gqm', preci = TRUE)
frc_new4 &lt;- applyBiasFactor(frc, biasFactor)

plotTS(obs, frc, frc_new, frc_new1, frc_new2, frc_new3, frc_new4, plot = 'cum')

# You can also give name to this input list.
TSlist &lt;- list(obs, frc, frc_new, frc_new1, frc_new2, frc_new3, frc_new4)
names(TSlist) &lt;- c('obs', 'frc', 'delta', 'delta_preci', 'scale', 'eqm', 'gqm')
plotTS(list = TSlist, plot = 'cum')


# If the forecasts you extracted only has incontinuous data for certain months and years, e.g.,
# for seasonal forecasting, forecasts only provide 3-6 months data, so the case can be 
# for example Dec, Jan and Feb of every year from year 1999-2005.
# In such case, you need to extract certain months and years from observed time series.
# extractPeriod() can be then used.
  
  



# More examples can be found in the user manual on https://yuanchao-xu.github.io/hyfo/


</code></pre>


</div>
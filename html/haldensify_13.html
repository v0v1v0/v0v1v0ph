<div class="container">

<table style="width: 100%;"><tr>
<td>predict.haldensify</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Prediction Method for HAL Conditional Density Estimation</h2>

<h3>Description</h3>

<p>Prediction Method for HAL Conditional Density Estimation
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'haldensify'
predict(
  object,
  ...,
  new_A,
  new_W,
  trim = TRUE,
  trim_min = NULL,
  lambda_select = c("cv", "undersmooth", "all")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object of class <code>haldensify</code>, containing the
results of fitting the highly adaptive lasso for conditional density
estimation, as produced by a call to <code>haldensify</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to <code>predict</code> as necessary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_A</code></td>
<td>
<p>The <code>numeric</code> vector or similar of the observed values for
which a conditional density estimate is to be generated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_W</code></td>
<td>
<p>A <code>data.frame</code>, <code>matrix</code>, or similar giving the
values of baseline covariates (potential confounders) for the conditioning
set of the observed values <code>A</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim</code></td>
<td>
<p>A <code>logical</code> indicating whether estimates of the conditional
density below the value indicated in <code>trim_min</code> should be truncated.
The default value of <code>TRUE</code> enforces truncation of any values below
the cutoff specified in <code>trim_min</code> and similarly truncates predictions
for any of <code>new_A</code> falling outside of the training support.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim_min</code></td>
<td>
<p>A <code>numeric</code> indicating the minimum allowed value of the
resultant density predictions. Any predicted density values below this
tolerance threshold are set to the indicated minimum. The default is to use
a scaled inverse square root of the sample size of the prediction set,
i.e., 5/sqrt(n)/log(n) (another notable choice is 1/sqrt(n)). If there are
observations in the prediction set with values of <code>new_A</code> outside of
the support of the training set (i.e., provided in the argument <code>A</code> to
<code>haldensify</code>), their predictions are similarly truncated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda_select</code></td>
<td>
<p>A <code>character</code> indicating whether to return the
predicted density for the value of the regularization parameter chosen by
the global cross-validation selector or whether to return an undersmoothed
sequence (which starts with the cross-validation selector's choice but also
includes all values in the sequence that are less restrictive). The default
is <code>"cv"</code> for the global cross-validation selector. Setting the choice
to <code>"undersmooth"</code> returns a matrix of predicted densities, with each
column corresponding to a value of the regularization parameter less than
or equal to the choice made by the global cross-validation selector. When
<code>"all"</code> is set, predictions are returned for the full sequence of the
regularization parameter on which the HAL model <code>object</code> was fitted.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Method for computing and extracting predictions of the conditional
density estimates based on the highly adaptive lasso estimator, returned as
an S3 object of class <code>haldensify</code> from <code>haldensify</code>.
</p>


<h3>Value</h3>

<p>A <code>numeric</code> vector of predicted conditional density values from
a fitted <code>haldensify</code> object.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># simulate data: W ~ U[-4, 4] and A|W ~ N(mu = W, sd = 0.5)
n_train &lt;- 50
w &lt;- runif(n_train, -4, 4)
a &lt;- rnorm(n_train, w, 0.5)
# HAL-based density estimator of A|W
haldensify_fit &lt;- haldensify(
  A = a, W = w, n_bins = 10L, lambda_seq = exp(seq(-1, -10, length = 100)),
  # the following arguments are passed to hal9001::fit_hal()
  max_degree = 3, reduce_basis = 1 / sqrt(length(a))
)
# predictions to recover conditional density of A|W
new_a &lt;- seq(-4, 4, by = 0.1)
new_w &lt;- rep(0, length(new_a))
pred_dens &lt;- predict(haldensify_fit, new_A = new_a, new_W = new_w)
</code></pre>


</div>
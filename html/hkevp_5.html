<div class="container">

<table style="width: 100%;"><tr>
<td>hkevp.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting procedure of the HKEVP with MCMC algorithm</h2>

<h3>Description</h3>

<p>Metropolis-within-Gibbs algorithm that returns samples from posterior distribution of all the parameters of the HKEVP.
</p>
<p>Most of the input parameters have default values, so that the procedure can be easily handled. However, convergence of the Markov chains should be assessed by using <code>mcmc.plot</code> for instance. The experimented user can set initial states, prior hyperparameters along with the magnitude of the MCMC jumps.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hkevp.fit(
  y,
  sites,
  knots,
  niter,
  nburn,
  nthin,
  quiet,
  trace,
  fit.margins,
  gev.vary,
  spatial.covariates,
  log.scale,
  correlation,
  mcmc.init,
  mcmc.prior,
  mcmc.jumps
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A matrix of observed block maxima. Each column corresponds to a site position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sites</code></td>
<td>
<p>The coordinates of the sites where the data are observed. Each row corresponds to a site position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>The coordinates of the knots in the HKEVP. By default, the positions of the knots coincide with the positions of the sites.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter</code></td>
<td>
<p>The number of MCMC iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nburn</code></td>
<td>
<p>The number of first MCMC iterations that are discarded. Zero by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nthin</code></td>
<td>
<p>The size of the MCMC thinning. One by default (i.e. no thinning).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>A logical indicating if the progression of the routine should be displayed. TRUE by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>If <code>quiet</code> is FALSE, the log-likelihood of the model is displayed each block of <code>trace</code> MCMC steps to observe fitting progression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit.margins</code></td>
<td>
<p>A logical that indicates if the GEV parameters should be fitted along with the dependence structure. TRUE by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gev.vary</code></td>
<td>
<p>A logical vector of size three indicating if the GEV parameters (respectively the location, the scale and the shape) are spatially-varying. If not (by default for the shape), the parameter is the same at each position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spatial.covariates</code></td>
<td>
<p>A numerical matrix of spatial covariates. Each row corresponds to a site position. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log.scale</code></td>
<td>
<p>A logical value indicating if the GEV scale parameter <code class="reqn">\sigma</code> is modelled by its log. FALSE by default. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correlation</code></td>
<td>
<p>A character string indicating the form of the correlation function associated to the latent Gaussian processes that describes the marginal parameters. Must be one of <code>"expo"</code>, <code>"gauss"</code>, <code>"mat32"</code> (By default) and <code>"mat52"</code>, respectively corresponding to the exponential, Gaussian, Matern-3/2 and Matern-5/2 correlation functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc.init</code></td>
<td>
<p>A named list indicating the initial states of the chains. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc.prior</code></td>
<td>
<p>A named list indicating the hyperparameters of the prior distributions. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc.jumps</code></td>
<td>
<p>A named list indicating the amplitude of the jumps to propose the MCMC candidates. See details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Details of the MCMC procedure are presented in <cite>Reich and Shaby (2012)</cite>. This function follows the indications and the choices of the authors, with the exception of several small changes:
</p>

<ul>
<li>
<p>The scale parameter <code class="reqn">\sigma</code> can be modelled like the two other marginal parameters as in <cite>Davison et al. (2012)</cite> or by its logarithm as in <cite>Reich and Shaby (2012)</cite>. For this, use the argument <code>log.scale</code>, set to FALSE by default.
</p>
</li>
<li>
<p>The Inverse-Gamma prior distributions defined for the bandwith parameter <code class="reqn">\tau</code> and for the ranges <code class="reqn">\lambda</code> of the latent processes are replaced by a Beta distribution over the interval <code class="reqn">[0,2D_{max}]</code>, where <code class="reqn">D_{max}</code> stands for the maximum distance between two sites.</p>
</li>
</ul>
<p>The procedure can be used normally with <code>fit.margins = TRUE</code> (default) or by assuming that the observed process had GEV(1,1,1) margins already and thus ignoring the marginal estimation.
</p>
<p>If the margins are estimated and the parameters are assumed spatially-varying, the user can provide spatial covariates to fit the mean of the latent Gaussian processes. Recall for instance for the GEV location parameter that:
</p>
<p style="text-align: center;"><code class="reqn">\mu(s) = \beta_{0,\mu} + \beta_{1,\mu} c_1(s) + ... + \beta_{p,\mu} c_p(s) ~.</code>
</p>

<p>The given matrix <code>spatial.covariates</code> that represents the <code class="reqn">c_i(s)</code> elements should have the first column filled with ones to account for the intercept <code class="reqn">\beta_0</code>.
</p>
<p>The arguments <code>mcmc.init</code>, <code>mcmc.prior</code> and <code>mcmc.jumps</code> are named list that have default values. The user can make point changes in these arguments, by setting <code>mcmc.init = list(alpha = .5)</code> for instance, but must respect the constraints of each element:
</p>

<ul>
<li>
<p><code>mcmc.init</code>. All elements are of length one. The possibilities are:
</p>

<ul>
<li>
<p><code>loc</code>, <code>scale</code> and <code>shape</code> (GEV parameters).
</p>
</li>
<li>
<p><code>range</code> and <code>sill</code> of the correlation functions.
</p>
</li>
<li>
<p><code>alpha</code>, <code>tau</code>, <code>A</code> and <code>B</code>, the dependence parameters and conditional variables of the HKEVP.</p>
</li>
</ul>
</li>
<li>
<p>mcmc.prior. The possible elements are:
</p>

<ul>
<li>
<p><code>constant.gev</code>: a <code class="reqn">2 \times 3</code> matrix of normal parameters for spatially-constant <code class="reqn">\mu</code>, <code class="reqn">\sigma</code> and <code class="reqn">\xi</code>. The first row are the means, the second are the standard deviations.
</p>
</li>
<li>
<p><code>beta.sd</code>: the normal sd prior of all <code class="reqn">\beta</code> parameters (a single value).
</p>
</li>
<li>
<p><code>range</code>, <code>alpha</code> and <code>tau</code>: the two Beta parameters.
</p>
</li>
<li>
<p><code>sill</code>: the two Inverse-Gamma parameters.</p>
</li>
</ul>
</li>
<li>
<p>mcmc.jumps. The possible elements are:
</p>

<ul>
<li>
<p><code>gev</code> and <code>range</code>: a vector of length 3 (for each GEV parameter).
</p>
</li>
<li>
<p><code>tau</code>, <code>alpha</code>, <code>A</code>, <code>B</code>: single values for each.</p>
</li>
</ul>
</li>
</ul>
<h3>Value</h3>

<p>A named list with following elements:
</p>

<ul>
<li>
<p><code>GEV</code>: the Markov chains associated to the GEV parameters. The dimensions of the array correspond respectively to the sites positions, the three GEV parameters and the states of the Markov chains.
</p>
</li>
<li>
<p><code>alpha</code>: the Markov chain associated to the dependence parameter <code class="reqn">\alpha</code>.
</p>
</li>
<li>
<p><code>tau</code>: the Markov chain associated to the dependence parameter <code class="reqn">\tau</code>.
</p>
</li>
<li>
<p><code>A</code>: the Markov chains associated to the positive stable random effect per site and per block. The dimensions correspond respectively to the indices of blocks, the knots positions and the states of the Markov chains.
</p>
</li>
<li>
<p><code>llik</code>: the log-likelihood of the model for each step of the algorithm.
</p>
</li>
<li>
<p><code>time</code>: time (in sec) spent for the fit.
</p>
</li>
<li>
<p><code>spatial</code>: a named list with four elements linked to the GEV spatially-varying parameters:
</p>

<ul>
<li>
<p><code>vary</code>: the argument <code>gev.vary</code>.
</p>
</li>
<li>
<p><code>beta</code>: the <code class="reqn">\beta</code> parameters for each GEV parameter. The dimensions correspond respectively to the steps of the Markov chains, the <code class="reqn">p</code> spatial covariates and the GEV parameters
</p>
</li>
<li>
<p><code>sills</code>: the Markov chains associated to the sills in the correlation functions of the latent Gaussian processes.
</p>
</li>
<li>
<p><code>ranges</code>: the Markov chains associated to the ranges in the correlation functions of the latent Gaussian processes.</p>
</li>
</ul>
</li>
<li>
<p><code>data</code>: the data fitted.
</p>
</li>
<li>
<p><code>sites</code>: the sites where the data are observed.
</p>
</li>
<li>
<p><code>knots</code>: the set of knots.
</p>
</li>
<li>
<p><code>spatial.covariates</code>: the spatial covariates.
</p>
</li>
<li>
<p><code>correlation</code>: the type of correlation function for the marginal latent processes.
</p>
</li>
<li>
<p><code>nstep</code>: the number of steps at the end of the routine after burn-in and thinning.
</p>
</li>
<li>
<p><code>log.scale</code>: a boolean indicating if the scale parameter has been modelled via its logarithm.
</p>
</li>
<li>
<p><code>fit.type</code>: either "hkevp" or "dep-only" character string to specify the type of fit.</p>
</li>
</ul>
<p>If <code>fit.margins</code> is false, only the dependence-related elements are returned.
</p>


<h3>Author(s)</h3>

<p>Quentin Sebille
</p>


<h3>References</h3>

<p>Reich, B. J., &amp; Shaby, B. A. (2012). A hierarchical max-stable spatial model for extreme precipitation. The annals of applied statistics, 6(4), 1430. &lt;DOI:10.1214/12-AOAS591&gt;
</p>
<p>Stephenson, A. G. (2009) High-dimensional parametric modelling of multivariate extreme events. Aust. N. Z. J Stat, 51, 77-88. &lt;DOI:10.1111/j.1467-842X.2008.00528.x&gt;
</p>
<p>Davison, A. C., Padoan, S. A., &amp; Ribatet, M. (2012). Statistical modeling of spatial extremes. Statistical Science, 27(2), 161-186. &lt;DOI:10.1214/11-STS376&gt;
</p>


<h3>See Also</h3>

<p>latent.fit
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Simulation of HKEVP:
set.seed(1)
sites &lt;- as.matrix(expand.grid(1:3,1:3))
loc &lt;- sites[,1]*10
scale &lt;- 3
shape &lt;- 0
alpha &lt;- .4
tau &lt;- 1
ysim &lt;- hkevp.rand(10, sites, sites, loc, scale, shape, alpha, tau)

# HKEVP fit:
fit &lt;- latent.fit(ysim, sites, niter = 1000)



</code></pre>


</div>
<div class="container">

<table style="width: 100%;"><tr>
<td>find_route</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Find best route between 2 airports</h2>

<h3>Description</h3>

<p><code>find_route</code> finds the quickest route between two airports, refuelling
if necessary
</p>


<h3>Usage</h3>

<pre><code class="language-R">find_route(
  ac,
  ap2,
  fat_map,
  avoid = NA,
  route_grid,
  cf_subsonic = NA,
  refuel = NA,
  refuel_h = 1,
  refuel_only_if = TRUE,
  refuel_topN = 1,
  max_circuity = 2,
  ap_loc,
  margin_km = 200,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ac</code></td>
<td>
<p>One aircraft, as from <code>make_aircraft</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ap2</code></td>
<td>
<p>One airport pair, as from <code>make_AP2</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fat_map</code></td>
<td>
<p><code>sf::MULTIPOLYGON</code> map of land, including buffer</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avoid</code></td>
<td>
<p><code>sf::MULTIPOLYGON</code> map of areas not to fly over</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>route_grid</code></td>
<td>
<p><code>GridLat</code> routing grid as from
<code>make_route_grid</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cf_subsonic</code></td>
<td>
<p>Further aircraft to use as comparator, default NA. (use is
not recommended)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refuel</code></td>
<td>
<p>Airports available for refuelling, dataframe with <code>APICAO,
long, lat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refuel_h</code></td>
<td>
<p>Duration of refuelling stop, in hours</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refuel_only_if</code></td>
<td>
<p>If TRUE (default) only test refuel options if necessary
because the great circle distance is too far for the aircraft range</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refuel_topN</code></td>
<td>
<p>Return the best N (default 1) refuelling options</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_circuity</code></td>
<td>
<p>Threshold for excluding refuelling stops (default 2.0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ap_loc</code></td>
<td>
<p>Airport locations as from <code>make_airports</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margin_km</code></td>
<td>
<p>Great circle distance between airports must be less than
aircraft range minus this operating margin (default 200km), to give
a margin for arrival and departure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters, passed to <code>find_leg</code> and thence to
to <code>make_route_envelope</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function finds the quickest route between two airports. A 'route' is
made up of one or two 'legs' (airport to airport without intermediate stop).
<code>find_route</code> makes one or more calls to <code>find_leg</code> as required.
</p>
<p>It assumes that the routing grid, <code>route_grid</code>, has already been
classified as land or sea using the map <code>fat_map</code>. The map is further
used when converting the grid-based route to one of great circles segments.
</p>


<h3>Value</h3>

<p>Dataframe with details of the route
</p>


<h3>Refuelling</h3>

<p>If either necessary, because the great circle distance is greater than the
aircraft range, or because <code>refuel_only_if</code> is FALSE,
<code>find_route</code> searches through a list of refuelling airports and
chooses the quickest one (or <code>refuel_topN</code>).
</p>
<p>Circuitous refuelling is avoided, tested against total distance &lt;
<code>max_circuity</code> * great circle distance. This is separate to the limits
placed on circuity of individual legs in <code>find_leg</code>.
</p>
<p>If no refuel option is found, a message is displayed. The route with 'NA'
for 'time_h' is returned.
</p>
<p>Each refuelling stop costs <code>refuel_h</code> in addition to the time to
descend to the airport and then to climb out again.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># need to load some of the built-in data
aircraft &lt;- make_aircraft(warn = FALSE)
# get test datasets
NZ_buffer30 &lt;- hm_get_test("buffer")
NZ_grid &lt;- hm_get_test("grid")
airports &lt;- make_airports(crs = sf::st_crs(NZ_buffer30))

options("quiet" = 4) #for heavy reporting
# from Auckland to Christchurch
ap2 &lt;- make_AP2("NZAA","NZCH",airports)
# on some CRAN machines even this takes too long, so not run
## Not run: 
routes &lt;- find_route(aircraft[4,],
                    ap2,
                    fat_map = NZ_buffer30,
                    route_grid = NZ_grid,
                    ap_loc = airports)

## End(Not run)

</code></pre>


</div>
<div class="container">

<table style="width: 100%;"><tr>
<td>spc.identify</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Identifying Spectra and Spectral Data Points
This function allows to identify the spectrum and the wavelength of a point
in a plot produced by <code>plotspc</code>.</h2>

<h3>Description</h3>

<p>This function first finds the spectrum with a point closest to the clicked
position (see <code>locator</code>). The distance to the clicked
point is evaluated relative to the size of the tolerance window.
</p>


<h3>Usage</h3>

<pre><code class="language-R">spc.identify(
  x,
  y = NULL,
  wavelengths = NULL,
  ispc = NULL,
  tol.wl = diff(range(x))/200,
  tol.spc = diff(range(y))/50,
  point.fn = spc.point.max,
  formatter = spc.label.default,
  ...,
  cex = 0.7,
  adj = c(0, 0.5),
  srt = 90,
  warn = TRUE
)

spc.point.max(wl, spc, wlclick)

spc.point.default(wl, spc, wlclick)

spc.point.min(wl, spc, wlclick)

spc.point.sqr(wl, spc, wlclick, delta = 1L)

spc.label.default(ispc, wl, spc, digits = 3)

spc.label.wlonly(ispc, wl, spc, digits = 3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>either the abscissa coordinates or the list returned by
<code>plotspc</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the ordinate values. Giving <code>y</code> will override any values from
<code>x$y</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wavelengths</code></td>
<td>
<p>the wavelengths for the data points. Giving
<code>wavelengths</code> will override any values from <code>x$wavelengths</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ispc</code></td>
<td>
<p>if a selection of spectra was plotted, their indices can be
given in <code>ispc</code>. In this case <code>ispc [i]</code> is returned rather
than <code>i</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol.wl, tol.spc</code></td>
<td>
<p>tolerance in wavelength and spectral intensity to
search around the clicked point. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>point.fn</code></td>
<td>
<p><code>function (wl, spc, wlclick)</code> to determine the actual
point to label, see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formatter</code></td>
<td>
<p><code>function (i, wl, spc)</code> that produces the labels. If
<code>NULL</code>, no labels are displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to <code>text</code> in order to produce the
labels</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex, adj, srt</code></td>
<td>
<p>see <code>par</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn</code></td>
<td>
<p>Should the user be warned if no point is in the considered
window? In addition, see the discussion of option <code>debuglevel</code> in
the details.
</p>
<p>If <code>FALSE</code>, the resulting data.frame will have a row of <code>NA</code>s
instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wl</code></td>
<td>
<p>the wavelength to label</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spc</code></td>
<td>
<p>the intensity to label</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wlclick</code></td>
<td>
<p>the clicked wavelength</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p><code>spc.point.sqr</code> fits the parabola in the window wlclick
<code class="reqn">\pm</code> delta points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>how many digits of the wavelength should be displayed?</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In a second step, <code>max.fn</code> searches for the actual point to label
within the specified wavelength window of that spectrum. This allows to
label maxima (or minima) without demanding too precise clicks. Currently,
the following functions to determine the precise point: </p>

<table>
<tr>
<td style="text-align: left;">
spc.point.default </td>
<td style="text-align: left;"> uses the clicked wavelength together with its
spectral intensity</td>
</tr>
<tr>
<td style="text-align: left;"> spc.point.max </td>
<td style="text-align: left;"> the point with the highest
intensity in the wavelength window </td>
</tr>
<tr>
<td style="text-align: left;"> spc.point.min </td>
<td style="text-align: left;"> the point with
the lowest intensity in the wavelength window </td>
</tr>
<tr>
<td style="text-align: left;"> spc.point.sqr </td>
<td style="text-align: left;">
maximum of a parabola fit throug the point with highest intensity and the
two surrounding points </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p><code>point.fn</code> is called with the arguments
<code>wl</code> containing the considered wavelength window, <code>spc</code> the
respective intensities of the closest spectrum, and <code>wlclick</code> the
wavelength that was clicked. They return a vector of two elements
(wavelength and intensity).
</p>
<p>As a last step, a label for the point produced by <code>formatter</code> and
plotted using <code>text</code>. Currently, the following
<code>formatter</code>s are available: </p>

<table>
<tr>
<td style="text-align: left;"> spc.label.default </td>
<td style="text-align: left;">
spectrum number, wavelength </td>
</tr>
<tr>
<td style="text-align: left;"> spc.label.wlonly </td>
<td style="text-align: left;"> wavelength</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p><code>formatter</code> functions receive the number of the spectrum <code>ispc</code>,
the wavelength <code>wl</code>, and the spectral intensity <code>spc</code> and produce
a character variable suitable for labelling. The predefined formatters
surround the label text by spaces in order to easily have an appropriate
offset from the point of the spectrum.
</p>
<p>The warning issued if no spectral point is inside the tolerance window may
be switched of by <code>warn = FALSE</code>. In that case, the click will produce
a row of <code>NA</code>s in the resulting data.frame.
</p>
<p><code>spc.identify</code> uses option <code>debuglevel</code> to determine whether debugging output should be
produced. <code>debuglevel == 2</code> will plot the tolerance window for every clicked point,
<code>debuglevel == 1</code> will plot the tolerance window only if no data point was inside.  See
<code>hyperSpec options</code> for details about retrieving and setting
options.
</p>
<p>You may want to adjust the plot's <code>ylim</code> to ensure that the labels are
not clipped. As a dirty shortcut, <code>xpd = NA</code> may help.
</p>


<h3>Value</h3>

<p>a <code>data.frame</code> with columns </p>
<table>
<tr style="vertical-align: top;">
<td><code>ispc</code></td>
<td>
<p>spectra indices of the
identified points, i.e. the rows of the <code>hyperSpec</code> object that was
plotted.
</p>
<p>If <code>ispc</code> is given, <code>ispc [i]</code> is returned rather than <code>i</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wavelengths</code></td>
<td>
<p>the wavelengths of the identified points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spc</code></td>
<td>
<p>the intensities of the identified points</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>C. Beleites
</p>


<h3>See Also</h3>

<p><code>locator</code>, <code>plotspc</code>,
<code>hyperSpec options</code>
</p>
<p><code>map.identify</code> <code>map.sel.poly</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
if (interactive ()){
ispc &lt;- sample (nrow (laser), 10)
ispc

identified &lt;- spc.identify (plotspc (laser[ispc]))

## convert to the "real" spectra indices
ispc [identified$ispc]
identified$wl
identified$spc

## allow the labels to be plotted into the plot margin
spc.identify (plotspc (laser[ispc]), ispc = ispc, xpd = NA) 

spc.identify (plotspc (paracetamol, xoffset = 1100,
              wl.range = c (600 ~ 1700, 2900 ~ 3150)),
              formatter = spc.label.wlonly)

## looking for minima
spc.identify (plot (-paracetamol, wl.reverse = TRUE),
              point.fn = spc.point.min, adj = c (1, 0.5))

}

</code></pre>


</div>
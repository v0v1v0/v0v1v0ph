<div class="container">

<table style="width: 100%;"><tr>
<td>HDCurves</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>R wrapper that accesses C code to fit hierarchical model for derivative curves based on sequence of quotient differences</h2>

<h3>Description</h3>

<p><code>HDCurves</code> is the main function used to fit the the hierarchical model for derivative curves. This function also fits single derivative curves.  Derivative curves are estimated based on a sequence of empirical derivatives.
</p>


<h3>Usage</h3>

<pre><code class="language-R">HDCurves(y, t, trt, ids, balanced = TRUE, tpred = NULL, ztype = 0,
  p = 0.5, au = 1, bu = 1, A = 2, as = 1, bs = 1, atau = 1,
  btau = 1/0.005, ndx = 10, q = 3, verbose = FALSE, draws = 1100,
  burn = 100, thin = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>numeric vector (response variable).  Must be in long format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>numeric vector (time variable). Must be in long format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trt</code></td>
<td>
<p>numeric vector indicating to which treatment each subject belongs.  The length of this vector is the same as "y" and "t" and must begin with 1.  The remaining treatment labels must form a contiguous sequence of integers.  See example below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ids</code></td>
<td>
<p>numeric vector containing subject id number.  The length of this vector is the same as "y" and "t".  Subject id numbers must begin with 1 and subsequent subject id numbers need to remain a contiguous sequence of integers.  See example below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>balanced</code></td>
<td>
<p>logical with <code>TRUE</code> corresponding to a balanced case, and <code>FALSE</code> to an unbalanced case</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tpred</code></td>
<td>
<p>numeric (time points for prediction).  If not supplied, the predictions at each observed time point are returned for subject-specific derivative curves.  For treatment-specific derivative curves a sequence of time points is produced based on the mininum and maximum observed time points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ztype</code></td>
<td>
<p>integer indicating which sequence of empirical derivatives will be employed.  (<code>0</code> indicates that which is parameterized by D and u while <code>1</code> indicates that which is parametrized by u)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>prior parameter for D, default is 0.5.  This value is not used if ztype=1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>au</code></td>
<td>
<p>shape prior parameter for u, default is 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bu</code></td>
<td>
<p>scale prior parameter for u, default is 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>parameter that defines upper bound for lambda.  Default is 2.  This parameter is not used in the case that a single derivative curve is being estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as</code></td>
<td>
<p>shape prior parameter associated with subject-specific variance (sigma2), default is 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bs</code></td>
<td>
<p>rate prior parameter associated with subject-specific variance (sigma2), default is 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>atau</code></td>
<td>
<p>shape prior parameter associated with penalty parameter (tau2), default is 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>btau</code></td>
<td>
<p>rate prior parameter associated with penalty parameter (tau2), default is 1/0.005</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ndx</code></td>
<td>
<p>number of segments (default is 10)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>degree of the B-spline (default is 3)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If TRUE, then details associated with data being fit are printed to screen along with MCMC iterate counter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draws</code></td>
<td>
<p>number of MCMC iterates to be collected. default is 1100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burn</code></td>
<td>
<p>number of MCMC iterates discared as burn-in. default is 100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>number by which the MCMC chain is thinne. default is 1</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list containing arrays filled with MCMC iterates corresponding to model parameters, sequence of empirical derivatives, and derivative curves.  In order to provide more detail, in what follows let
</p>
<p>"T" - be the number of MCMC iterates collected,
</p>
<p>"M" - be the number of subjects,
</p>
<p>"N" - be the total number of measured responses,
</p>
<p>"K" - be the maximum number of observations measured across the M subjects,
</p>
<p>"V" - the number of prediction points in the user supplied vector tpred,
</p>
<p>"P" - the number of P-spline basis coefficients, and
</p>
<p>"G" - the number of treatment groups.
</p>
<p>The output list contains the following
</p>
<table>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>an array of dimension (K, M, T) containing MCMC iterates associated with sequence of empirical derivatives for each subject. In the case of an unbalanced design, for subjects with less than K observations the values in the array beyond the number of measured responses for the subject are of no use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>an array of dimension (M, P, T) containing MCMC iterates assocated with subject-specific B-spline basis coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tpred</code></td>
<td>
<p>vector of size V containing the prediction points supplied in the "tpred" argument of the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fprime</code></td>
<td>
<p>an array of dimension (V, M, T) if "tpred" is supplied or (K, M, T) if not that contains MCMC iterates associated with derivative curves for each subject. In the case of an unbalanced design and "tpred" not being supplied, for subjects with less than K observations the values in the array beyond the number of measured responses for the subject are of no use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>a matrix of dimension (T, M) containing MCMC interates associated with "u".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>a matrix of dimension (T, M) containing MCMC interates associated with "d".  If ztype=1, then this array is of no use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig2</code></td>
<td>
<p>a matrix of dimension (T, M) containing MCMC interates associated with "sigma2".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>an array of dimension (G, P, T) containing MCMC iterates associated with group-specific B-spline basis coefficients ("theta"). In the case of a single subject, this array is of no use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fgprime</code></td>
<td>
<p>an array of dimension (V, M, T) if "tpred" is supplied or (K, M, T) if not that contains MCMC iterates associated with group-specific derivative curves.  In the case of a single subject, this array is of no use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lam</code></td>
<td>
<p>a matrix of dimension (T, G) containing MCMC iterates associated with "lambda" the upper bound of "sigma2". In the case of a single subject, this array is of no use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau2</code></td>
<td>
<p>a matrix of dimesino (T, G) containing MCMC iterates associated with "tau2" the penalty parameters the the P-spline specification.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HmatBySubject</code></td>
<td>
<p>an array that contains the basis design matrix for each subject.  If the study is balanced, then this is a single matrix of dimensino (M, P).  If the design is not balanced, this is a one-dimensional array of size P x (the total number of observations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Htheta</code></td>
<td>
<p>a matrix of dimension (M, P) that contains the basis design matrix used for each treatment group.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>“Bayesian Hierarchical Modeling of Growth Curve Derivatives via Sequences of Quotient Differences” Journal of the Royal Statistical Society: Series C 69(2) 459-481
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  # Our R-package
  library(HDCurves)

  data(growth)

  nmale &lt;- ncol(growth$hgtm)
  nfemale &lt;- ncol(growth$hgtf)
  ntime &lt;- nrow(growth$hgtf)

  dat &lt;- data.frame(age=rep(growth$age, nmale + nfemale),
        height = c(growth$hgtm, growth$hgtf),
        tmt = c(rep(1, nmale*ntime),
                rep(2, nfemale*ntime)),
        case = rep(1:(nmale+nfemale), each=ntime))


  ############
  # MCMC Specs
  ############
  ni &lt;- 20000
  nb &lt;- 10000
  nt &lt;- 10
  nout &lt;- (ni - nb)/nt

  # B-spline details
  ndx &lt;- 40  	# number of segments (inner knots)
  bdeg &lt;- 3 	# Degree of the B-spline
  tt &lt;- sort(unique(dat$age))

  
  # This takes about 5 minutes to run
  date();
  fit &lt;- HDCurves(y = dat$height, t = dat$age, tpred = tt, trt = dat$tmt,
                  ids = dat$case, ztype = 0,  p = 0.9, A = 1,  au = 1, bu = 1,
                  as = 1, bs = 1, atau = 1, btau = 1/0.5, ndx = ndx, q = bdeg,
                  balanced = TRUE,draws=ni, burn=nb, thin=nt)
  date();

  # subject-specific derivative curve means
  fpmn &lt;- apply(fit$fprime,c(1,2),mean)


  # group-specific derivative curve means
  gfpmn &lt;- apply(fit$fgprime,c(1,2),mean)
  gfpci &lt;- apply(fit$fgprime,c(1,2),
        function(x) quantile(x, c(0.0275, 0.975)))

  plot(tt,gfpmn[,1], type="n", ylim=range(c(gfpmn)),
      ylab="Height  Rate of Change", xlab="age",
      xaxp=c(2,18,n=8),cex.axis=1.45, cex.lab=1.45)
  lines(tt, gfpmn[,1], type='o', col='blue', pch=20)
  lines(tt, gfpci[1,,1],  col='blue', pch=20,lty=2)
  lines(tt, gfpci[2,,1],  col='blue', pch=20,lty=2)

  lines(tt, gfpmn[,2], type='o', col='red', pch=20)
  lines(tt, gfpci[1,,2],  col='red', pch=20,lty=2)
  lines(tt, gfpci[2,,2],  col='red', pch=20,lty=2)
  legend(x="topright", lty=1, pch=20, cex=1.45,
        legend=c("Girls","Boys"), col=c("red","blue"))
  

</code></pre>


</div>
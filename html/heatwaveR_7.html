<div class="container">

<table style="width: 100%;"><tr>
<td>detect_event</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Detect heatwaves and cold-spells.</h2>

<h3>Description</h3>

<p>Applies the Hobday et al. (2016) marine heat wave definition to an input time
series of a given value (usually, but not necessarily limited to, temperature)
along with a daily date vector and pre-calculated seasonal and threshold
climatologies, which may either be created with <code>ts2clm</code> or some
other means.
</p>


<h3>Usage</h3>

<pre><code class="language-R">detect_event(
  data,
  x = t,
  y = temp,
  seasClim = seas,
  threshClim = thresh,
  threshClim2 = NA,
  minDuration = 5,
  minDuration2 = minDuration,
  joinAcrossGaps = TRUE,
  maxGap = 2,
  maxGap2 = maxGap,
  coldSpells = FALSE,
  protoEvents = FALSE,
  categories = FALSE,
  roundRes = 4,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame with at least four columns. In the default setting
(i.e. omitting the arguments <code>x</code>, <code>y</code>, <code>seas</code>, and <code>thresh</code>;
see immediately below), the data set is expected to have the headers <code>t</code>,
<code>temp</code>, <code>seas</code>, and <code>thresh</code>. The <code>t</code>
column is a vector of dates of class <code>Date</code>, <code>temp</code> is the measured
variable (by default it is assumed to be temperature), <code>seas</code> is the seasonal
cycle daily climatology (366 days), and <code>thresh</code> is the seasonal cycle
daily threshold above which events may be detected. Data of the appropriate
format are created by the function <code>ts2clm</code>, but your own data
can be supplied if they meet the criteria specified by <code>ts2clm</code>.
If the column names of <code>data</code> match those outlined here, the following
four arguments may be ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>This column is expected to contain a vector of dates as per the
specification of <code>ts2clm</code>. If a column headed <code>t</code> is present in
the dataframe, this argument may be omitted; otherwise, specify the name of
the column with dates here.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>This is a column containing the measurement variable. If the column
name differs from the default (i.e. <code>temp</code>), specify the name here.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seasClim</code></td>
<td>
<p>The dafault for this argument assumes that the seasonal
climatology column is called <code>seas</code> as this matches the output of
<code>ts2clm</code>. If the column name for the seasonal climatology is
different, provide that here.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshClim</code></td>
<td>
<p>The threshold climatology column should be called
<code>thresh</code>. If it is not, provide the name of the threshold column here.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshClim2</code></td>
<td>
<p>If one wishes to provide a second climatology threshold
filter for the more rigorous detection of events, a vector or column containing
logical values (i.e. TRUE FALSE) should be provided here. By default this
argument is ignored. It's primary purpose is to allow for the inclusion of
tMin and tMax thresholds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minDuration</code></td>
<td>
<p>The minimum duration for acceptance of detected events.
The default is <code>5</code> days.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minDuration2</code></td>
<td>
<p>The minimum duration for acceptance of events after
filtering by <code>threshClim</code> and <code>threshClim</code>. By default
<code>minDuration2 = minDuration</code> and is ignored if <code>threshClim2</code> has not
been specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>joinAcrossGaps</code></td>
<td>
<p>Boolean switch indicating whether to join events which
occur before/after a short gap as specified by <code>maxGap</code>. The default
is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxGap</code></td>
<td>
<p>The maximum length of gap allowed for the joining of MHWs. The
default is <code>2</code> days.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxGap2</code></td>
<td>
<p>The maximum gap length after applying both thresholds.
By default <code>maxGap2 = maxGap</code> and is ignored if <code>threshClim2</code> has not
been specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coldSpells</code></td>
<td>
<p>Boolean specifying if the code should detect cold events
instead of warm events. The default is <code>FALSE</code>. Please note that the
climatological thresholds for cold-spells are considered to be the inverse
of those for MHWs. For example, the default setting for the detection of
MHWs is <code>pctile = 90</code>, as seen in <code>ts2clm</code>. Should one want
to use <code>detect_event</code> for MCSs, this threshold would best be generated
in <code>ts2clm</code> by setting <code>pctile = 10</code> (see example below).
Any value may be used, but this is the setting used for the calculation of
MCSs in Schlegel et al. (2017a).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>protoEvents</code></td>
<td>
<p>Boolean specifying whether the full time series must be
returned as a long table, together with columns indicating whether or not the
threshold criterion (<code>threshCriterion</code>) and duration criterion (<code>durationCriterion</code>)
have been exceeded, a column showing if a heatwave is present (i.e. both
<code>threshCriterion</code> and <code>durationCriterion</code> <code>TRUE</code>), and a
sequential number uniquely identifying the detected event. In this case,
the heatwave metrics will not be reported. The default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>categories</code></td>
<td>
<p>Rather than using <code>category</code> as a separate step to determine
the categories of the detected MHWs, one may choose to set this argument to <code>TRUE</code>.
One may pass the same arguments used in the <code>category</code> function to this function
to affect the output. Note that the default behaviour of <code>category</code> is to
return the event data only. To return the same list structure that <code>detect_event</code>
outputs by default, use <code>climatology = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roundRes</code></td>
<td>
<p>This argument allows the user to choose how many decimal places
the MHW metric outputs will be rounded to. Default is 4. To
prevent rounding set <code>roundRes = FALSE</code>. This argument may only be given
numeric values or FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments that will be passed internally to <code>category</code>
when <code>categories = TRUE</code>. See the documentation for <code>category</code> for the
list of possible arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ol>
<li>
<p> This function assumes that the input time series consists of continuous
daily values with few missing values. Time ranges which start and end
part-way through the calendar year are supported. The accompanying function
<code>ts2clm</code> aids in the preparation of a time series that is
suitable for use with <code>detect_event</code>, although this may also be accomplished
'by hand' as long as the criteria are met as discussed in the documentation
to <code>ts2clm</code>.
</p>
</li>
<li>
<p> The calculation of onset and decline rates assumes that the events
started a half-day before the start day and ended a half-day after the
end-day. This is consistent with the duration definition as implemented,
which assumes duration = end day - start day + 1. An event that is already
present at the beginning of a time series, or an event that is still present
at the end of a time series, will report the rate of onset or the rate of
decline as <code>NA</code>, as it is impossible to know what the temperature half a
day before or after the start or end of the event is.
</p>
</li>
<li>
<p> For the purposes of event detection, any missing temperature values not
interpolated over (through optional <code>maxPadLength</code> in <code>ts2clm</code>)
will be set equal to the seasonal climatology. This means they will trigger
the end/start of any adjacent temperature values which satisfy the event
definition criteria.
</p>
</li>
<li>
<p> If the code is used to detect cold events (<code>coldSpells = TRUE</code>),
then it works just as for heat waves except that events are detected as
deviations below the (100 - pctile)th percentile (e.g., the 10th instead of
90th) for at least 5 days. Intensities are reported as negative values and
represent the temperature anomaly below climatology.
</p>
</li>
</ol>
<p>The original Python algorithm was written by Eric Oliver, Institute for
Marine and Antarctic Studies, University of Tasmania, Feb 2015, and is
documented by Hobday et al. (2016). The marine cold spell option was
implemented in version 0.13 (21 Nov 2015) of the Python module as a result
of our preparation of Schlegel et al. (2017), wherein the cold events
receive a brief overview.
</p>


<h3>Value</h3>

<p>The function will return a list of two tibbles (see the <code>tidyverse</code>),
<code>climatology</code> and <code>event</code>, which are, surprisingly, the climatology
and event results, respectively. The climatology contains the full time series of
daily temperatures, as well as the the seasonal climatology, the threshold
and various aspects of the events that were detected. The software was
designed for detecting extreme thermal events, and the units specified below
reflect that intended purpose. However, various other kinds of extreme
events may be detected according to the specifications, and if that is the
case, the appropriate units need to be determined by the user.
</p>
<p>The <code>climatology</code> results will contain the same column produced by
<code>ts2clm</code> as well as the following:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>threshCriterion</code></td>
<td>
<p>Boolean indicating if <code>temp</code> exceeds
<code>thresh</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>durationCriterion</code></td>
<td>
<p>Boolean indicating whether periods of consecutive
<code>threshCriterion</code> are &gt;= <code>min_duration</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>Boolean indicating if all criteria that define an extreme event
are met.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event_no</code></td>
<td>
<p>A sequential number indicating the ID and order of
occurrence of the events.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity</code></td>
<td>
<p>The difference between <code>temp</code> (or whichever column is provided
for <code>y</code>) and <code>seas</code>. Only added if <code>categories = TRUE</code>
and <code>climatology = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>category</code></td>
<td>
<p>The category classification per day. Only added
if <code>categories = TRUE</code> and <code>climatology = TRUE</code>.</p>
</td>
</tr>
</table>
<p>The <code>event</code> results are summarised using a range of event metrics:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>event_no</code></td>
<td>
<p>A sequential number indicating the ID and order of
the events.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index_start</code></td>
<td>
<p>Start index of event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index_end</code></td>
<td>
<p>End index of event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>duration</code></td>
<td>
<p>Duration of event [days].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date_start</code></td>
<td>
<p>Start date of event [date].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date_end</code></td>
<td>
<p>End date of event [date].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date_peak</code></td>
<td>
<p>Date of event peak [date].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity_mean</code></td>
<td>
<p>Mean intensity [deg. C].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity_max</code></td>
<td>
<p>Maximum (peak) intensity [deg. C].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity_var</code></td>
<td>
<p>Intensity variability (standard deviation) [deg. C].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intensity_cumulative</code></td>
<td>
<p>Cumulative intensity [deg. C x days].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate_onset</code></td>
<td>
<p>Onset rate of event [deg. C / day].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate_decline</code></td>
<td>
<p>Decline rate of event [deg. C / day].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event_name</code></td>
<td>
<p>The name of the event. Generated from the <code>name</code>
value provided and the year of the <code>date_peak</code> of
the event. If no <code>name</code> value is provided the default "Event" is used.
As proposed in Hobday et al. (2018), <code>Moderate</code> events are not given a name
so as to prevent multiple repeat names within the same year. If two or more events
ranked greater than Moderate are reported within the same year, they will be
differentiated with the addition of a trailing letter
(e.g. Event 2001a, Event 2001b). Only added if <code>categories = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>category</code></td>
<td>
<p>The maximum category threshold reached/exceeded by the event.
Only added if <code>categories = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_moderate</code></td>
<td>
<p>The proportion of the total duration (days) spent at or above
the first threshold, but below any further thresholds. Only added if <code>categories = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_strong</code></td>
<td>
<p>The proportion of the total duration (days) spent at or above
the second threshold, but below any further thresholds. Only added if <code>categories = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_severe</code></td>
<td>
<p>The proportion of the total duration (days) spent at or above
the third threshold, but below the fourth threshold. Only added if <code>categories = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_extreme</code></td>
<td>
<p>The proportion of the total duration (days) spent at or above
the fourth and final threshold. Only added if <code>categories = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>season</code></td>
<td>
<p>The season(s) during which the event occurred. If the event
occurred across two seasons this will be displayed as e.g. "Winter/Spring".
Across three seasons as e.g. "Winter-Summer". Events lasting across four or more
seasons are listed as "Year-round". December (June) is used here as the start of
Austral (Boreal) summer. If "start", "peak", or "end" was given to the <code>season</code>
argument then only the one season during that chosen period will be given.
Only added if <code>categories = TRUE</code>.</p>
</td>
</tr>
</table>
<p><code>intensity_max_relThresh</code>, <code>intensity_mean_relThresh</code>,
<code>intensity_var_relThresh</code>, and <code>intensity_cumulative_relThresh</code>
are as above except relative to the threshold (e.g., 90th percentile) rather
than the seasonal climatology.
</p>
<p><code>intensity_max_abs</code>, <code>intensity_mean_abs</code>, <code>intensity_var_abs</code>, and
<code>intensity_cumulative_abs</code> are as above except as absolute magnitudes
rather than relative to the seasonal climatology or threshold.
</p>
<p>Note that <code>rate_onset</code> and <code>rate_decline</code> will return <code>NA</code>
when the event begins/ends on the first/last day of the time series. This
may be particularly evident when the function is applied to large gridded
data sets. Although the other metrics do not contain any errors and
provide sensible values, please take this into account in its
interpretation.
</p>


<h3>Author(s)</h3>

<p>Albertus J. Smit, Robert W. Schlegel, Eric C. J. Oliver
</p>


<h3>References</h3>

<p>Hobday, A.J. et al. (2016). A hierarchical approach to defining
marine heatwaves, Progress in Oceanography, 141, pp. 227-238,
doi:10.1016/j.pocean.2015.12.014
</p>
<p>Schlegel, R. W., Oliver, C. J., Wernberg, T. W., Smit, A. J. (2017).
Nearshore and offshore co-occurrences of marine heatwaves and cold-spells.
Progress in Oceanography, 151, pp. 189-205, doi:10.1016/j.pocean.2017.01.004
</p>


<h3>Examples</h3>

<pre><code class="language-R">res_clim &lt;- ts2clm(sst_WA, climatologyPeriod = c("1983-01-01", "2012-12-31"))
out &lt;- detect_event(res_clim)
# show a portion of the climatology:
out$climatology[1:10, ]
# show some of the heat waves:
out$event[1:5, 1:10]

# Or if one wants to calculate MCSs
res_clim &lt;- ts2clm(sst_WA, climatologyPeriod = c("1983-01-01", "2012-12-31"),
                   pctile = 10)
out &lt;- detect_event(res_clim, coldSpells = TRUE)
# show a portion of the climatology:
out$climatology[1:10, ]
# show some of the cold-spells:
out$event[1:5, 1:10]

# It is also possible to calculate the categories of events directly
# See the \code{\link{category}} documentation for more functionality
res_clim &lt;- ts2clm(sst_WA, climatologyPeriod = c("1983-01-01", "2012-12-31"))
out_event &lt;- detect_event(res_clim, categories = TRUE)
out_list &lt;- detect_event(res_clim, categories = TRUE, climatology = TRUE)

# It is also possible to give two separate sets of threshold criteria

# To use a second static threshold we first use the exceedance function
thresh_19 &lt;- exceedance(sst_Med, threshold = 19, minDuration = 10, maxGap = 0)$threshold
# Then we use that output when detecting our events
events_19 &lt;- detect_event(ts2clm(sst_Med, climatologyPeriod = c("1982-01-01", "2011-12-31")),
                         threshClim2 = thresh_19$exceedance, minDuration2 = 10, maxGap2 = 0)

# If we want to use two different percentile thresholds we use detect_event
thresh_95 &lt;- detect_event(ts2clm(sst_Med, pctile = 95,
                                 climatologyPeriod = c("1982-01-01", "2011-12-31")),
                          minDuration = 2, maxGap = 0)$climatology
# Then we use that output when detecting our events
events_95 &lt;- detect_event(ts2clm(sst_Med, climatologyPeriod = c("1982-01-01", "2011-12-31")),
                          threshClim2 = thresh_95$event, minDuration2 = 2, maxGap2 = 0)

</code></pre>


</div>
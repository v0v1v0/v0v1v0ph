<div class="container">

<table style="width: 100%;"><tr>
<td>add_pfafstetter</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add Pfafstetter Codes</h2>

<h3>Description</h3>

<p>Determines Pfafstetter codes for a dendritic network with
total drainage area, levelpath, and topo_sort attributes. Topo_sort and
levelpath attributes must be self consistent (levelpath values are the
same as the outlet topo_sort value) as generated by add_levelpaths.
</p>


<h3>Usage</h3>

<pre><code class="language-R">add_pfafstetter(x, max_level = 2, status = FALSE)

## S3 method for class 'data.frame'
add_pfafstetter(x, max_level = 2, status = FALSE)

## S3 method for class 'hy'
add_pfafstetter(x, max_level = 2, status = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame network compatible with hydroloom_names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_level</code></td>
<td>
<p>integer number of levels to attempt to calculate.
If the network doesn't have resolution to support the desired level,
unexpected behavior may occur.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>status</code></td>
<td>
<p>boolean if status updates should be printed.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data.frame with added pfafstetter column
</p>


<h3>Examples</h3>

<pre><code class="language-R">
x &lt;- sf::read_sf(system.file("extdata/new_hope.gpkg", package = "hydroloom"))

x &lt;- add_toids(x)

pfaf &lt;- add_pfafstetter(x, max_level = 2)

plot(pfaf["pf_level_2"], lwd = 2)


if(require(nhdplusTools)) {

# uses tempdir for example
work_dir &lt;- nhdplusTools::nhdplusTools_data_dir(tempdir())

try(
source(system.file("extdata/nhdplushr_data.R", package = "nhdplusTools"))
)
if(exists("hr_data")) {
x &lt;- hy(hr_data$NHDFlowline)

x &lt;- add_toids(x)

x &lt;- dplyr::select(x, id, toid, da_sqkm)

#' add terminal_id -- add in function?
x &lt;- sort_network(x, split = TRUE)

x$total_da_sqkm &lt;- accumulate_downstream(x, "da_sqkm")
x$name &lt;- ""

x &lt;- add_levelpaths(x, name_attribute = "name", weight_attribute = "total_da_sqkm")

x &lt;- add_pfafstetter(x, max_level = 3)

plot(x["pf_level_3"], lwd = 2)

pfaf &lt;- add_pfafstetter(x, max_level = 4)

hr_catchment &lt;- dplyr::left_join(hr_data$NHDPlusCatchment,
                                 sf::st_drop_geometry(pfaf), by = c("FEATUREID" = "id"))

colors &lt;- data.frame(pf_level_4 = unique(hr_catchment$pf_level_4),
                     color = sample(terrain.colors(length(unique(hr_catchment$pf_level_4)))))

hr_catchment &lt;- dplyr::left_join(hr_catchment, colors, by = "pf_level_4")

plot(hr_catchment["color"], border = NA, reset = FALSE)
plot(sf::st_geometry(x), col = "blue", add = TRUE)
} else {
  message("nhdplusTools &gt; 1.0 required for this example")
}
}

</code></pre>


</div>
<div class="container">

<table style="width: 100%;"><tr>
<td>MAR_simulation_results</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Missing at random (MAR) simulation results.
</h2>

<h3>Description</h3>

<p>Results of a simulation study on the effect of missing data on estimates of parameters of a hidden Markov model. In the simulation, 1000 datasets were simulated, each consisting of 100 time series of length 50. The model generating the data was a hidden Markov model with 3 states. Missing values were generated for 25% of cases, independent of the hidden state (i.e. data can be considered missing at random.)
</p>


<h3>Usage</h3>

<pre><code class="language-R">data("MAR_simulation_results")</code></pre>


<h3>Format</h3>

<p>A <code>data.frame</code> with the following variables:
</p>

<dl>
<dt><code>parameter</code></dt>
<dd>
<p>Parameter name</p>
</dd>
<dt><code>true</code></dt>
<dd>
<p>True value of parameter</p>
</dd>
<dt><code>MAR_estimates_mean</code></dt>
<dd>
<p>Average of parameter estimates for a model that assumes MAR.</p>
</dd>
<dt><code>MAR_estimates_sd</code></dt>
<dd>
<p>Standard deviation of parameter estimates for a model that assumes MAR.</p>
</dd>
<dt><code>MAR_estimates_MAE</code></dt>
<dd>
<p>Mean Absolute Error of parameter estimates for a model that assumes MAR.</p>
</dd>
<dt><code>MNAR_estimates_mean</code></dt>
<dd>
<p>Average of parameter estimates for a model that assumes MNAR.</p>
</dd>
<dt><code>MNAR_estimates_sd</code></dt>
<dd>
<p>Standard deviation of parameter estimates for a model that assumes MNAR.</p>
</dd>
<dt><code>MNAR_estimates_MAE</code></dt>
<dd>
<p>Mean Absolute Error of parameter estimates for a model that assumes MNAR.</p>
</dd>
<dt><code>percMAE</code></dt>
<dd>
<p>Relative MAE of the MNAR model over the MAR model (e.g. MAE_MNAR/MAE_MAR)</p>
</dd>
</dl>
<h3>Details</h3>

<p>This data frame was generated with the following code
</p>
<pre>
library(depmixS4)

### Start simulation

nsim &lt;- 1000
nrep &lt;- 100
nt &lt;- 50

set.seed(1234)
randomSeeds &lt;- sample(seq(1,nsim*1000),nsim)
out &lt;- rep(list(vector("list",3)),nsim)

prior &lt;- c(8,1,1)
prior &lt;- prior/sum(prior)
transition &lt;- 5*diag(3) + 1
transition &lt;- transition/rowSums(transition)
means &lt;- c(-1,0,1)
sds &lt;- c(3,3,3)
pmiss &lt;- c(.25,.25,.25)

truepars1 &lt;- c(prior,as.numeric(t(transition)),as.numeric(rbind(means,sds)))
truepars2 &lt;- c(prior,as.numeric(t(transition)),as.numeric(rbind(means,sds,1-pmiss,pmiss)))

for(sim in 1:nsim) {
  set.seed(randomSeeds[sim])
  truestate &lt;- matrix(nrow=nt,ncol=nrep) 
  for(i in 1:nrep) {
    truestate[1,i] &lt;- sample(1:3,size=1,prob=prior)
    for(t in 2:nt) {
      truestate[t,i] &lt;- sample(1:3,size=1,prob=transition[truestate[t-1,i],])
    }
  }
  dat &lt;- data.frame(trueState=as.numeric(truestate),trial=1:nt)
  dat$trueResponse &lt;- rnorm(nrow(dat),mean=means[dat$trueState],sd=sds[dat$trueState])
  dat$missing &lt;- rbinom(nrow(dat),size=1,prob=pmiss[dat$trueState])
  dat$response &lt;- dat$trueResponse
  dat$response[dat$missing==1] &lt;- NA
  
  set.seed(randomSeeds[sim])
  mod &lt;- depmix(list(response~1),family=list(gaussian()),data=dat,nstates=3,ntimes=rep(nt,nrep))
  mod &lt;- setpars(mod,truepars1)
  ok &lt;- FALSE
  ntry &lt;- 1
  while(!ok &amp; ntry &lt;= 50) {
    fmod &lt;- try(fit(mod,emcontrol=em.control(maxit = 5000, random.start=FALSE),verbose=FALSE))
    if(!inherits(fmod,"try-error")) {
      if(fmod@message == "Log likelihood converged to within tol. (relative change)") ok &lt;- TRUE
    }
    ntry &lt;- ntry + 1
  }
  out[[sim]][[1]] &lt;- list(pars=getpars(fmod),logLik=logLik(fmod),viterbi=posterior(fmod)[,1],trueState=dat$trueState)
  
  set.seed(randomSeeds[sim])
  mod &lt;- depmix(list(response~1,missing~1),family=list(gaussian(),multinomial("identity")),data=dat,nstates=3,ntimes=rep(nt,nrep))
  mod &lt;- setpars(mod,truepars2)
  ok &lt;- FALSE
  ntry &lt;- 1
  while(!ok &amp; ntry &lt;= 50) {
    fmod &lt;- try(fit(mod,emcontrol=em.control(maxit = 5000, random.start = FALSE),verbose=FALSE))
    if(!inherits(fmod,"try-error")) {
      if(fmod@message == "Log likelihood converged to within tol. (relative change)") ok &lt;- TRUE
    }
    ntry &lt;- ntry + 1
  }
  out[[sim]][[2]] &lt;- list(pars=getpars(fmod),logLik=logLik(fmod),viterbi=posterior(fmod)[,1],trueState=dat$trueState)
}

### End simulation

### Process results
library(reshape2)
library(dplyr)
library(tidyr)

simi &lt;- out

bias1 &lt;- matrix(0.0,ncol=length(truepars1),nrow=nsim)
bias2 &lt;- matrix(0.0,ncol=length(truepars2),nrow=nsim)

colnames(bias1) &lt;- names(simi[[1]][[1]][[1]])
colnames(bias2) &lt;- names(simi[[1]][[2]][[1]])

pcorstate1 &lt;- rep(0.0,nsim)
pcorstate2 &lt;- rep(0.0,nsim)

for(sim in 1:nsim) {
  tmp &lt;- simi[[sim]][[1]][[1]]
  pr &lt;- tmp[1:3]
  trt &lt;- matrix(tmp[4:12],ncol=3)
  ms &lt;- tmp[c(13,15,17)]
  sds &lt;- tmp[c(14,16,18)] 
  ord &lt;- order(ms)
  bias1[sim,] &lt;- c(pr[ord],trt[ord,ord],as.numeric(rbind(ms[ord],sds[ord]))) - truepars1
  fsta &lt;- recode(simi[[sim]][[1]]$viterbi,`1` = which(ord == 1), `2` = which(ord == 2), `3` = which(ord == 3))
  pcorstate1[sim] &lt;- sum(fsta == simi[[sim]][[1]]$trueState)/(nrep*nt)
  
  tmp &lt;- simi[[sim]][[2]][[1]]
  pr &lt;- tmp[1:3]
  trt &lt;- matrix(tmp[4:12],ncol=3)
  ms &lt;- tmp[c(13,17,21)]
  sds &lt;- tmp[c(14,18,22)]
  ps0 &lt;- tmp[c(15,19,23)]
  ps1 &lt;- tmp[c(16,20,24)]
  ord &lt;- order(ms)
  bias2[sim,] &lt;- c(pr[ord],trt[ord,ord],as.numeric(rbind(ms[ord],sds[ord],ps0[ord],ps1[ord]))) - truepars2
  fsta &lt;- recode(simi[[sim]][[2]]$viterbi,`1` = which(ord == 1), `2` = which(ord == 2), `3` = which(ord == 3))
  pcorstate2[sim] &lt;- sum(fsta == simi[[sim]][[2]]$trueState)/(nrep*nt)
}

sim3_bias1 &lt;- bias1
sim3_bias2 &lt;- bias2
sim3_est1 &lt;- t(t(bias1) + truepars1)
sim3_est2 &lt;- t(t(bias2) + truepars2)
sim3_pcorstate1 &lt;- pcorstate1
sim3_pcorstate2 &lt;- pcorstate2

tmp &lt;- as.data.frame(sim3_est1)
colnames(tmp) &lt;- c("$\pi_1$","$\pi_2$","$\pi_3$","$a_{11}$","$a_{12}$","$a_{13}$","$a_{21}$","$a_{22}$","$a_{23}$","$a_{31}$","$a_{32}$", "$a_{33}$", "$\mu_1$","$\sigma_1$","$\mu_2$","$\sigma_2$","$\mu_3$","$\sigma_3$")
tmp$sim &lt;- 1:nsim
tmp &lt;- gather(tmp,key="param",value="estimate",-sim)
tmp$true &lt;- rep(truepars1,each=nsim)
tmp$method &lt;- "MAR"
tmp$variance &lt;- "low"
tmp$missing &lt;- "equal"
sim4_est1_long &lt;- tmp

tmp &lt;- as.data.frame(sim3_est2)
colnames(tmp) &lt;- c("$\pi_1$","$\pi_2$","$\pi_3$","$a_{11}$","$a_{12}$","$a_{13}$","$a_{21}$","$a_{22}$","$a_{23}$","$a_{31}$","$a_{32}$", "$a_{33}$", "$\mu_1$","$\sigma_1$","pnm_1","$p(M=1|S=1)$","$\mu_2$","$\sigma_2$","pnm_2","$p(M=1|S=2)$","$\mu_3$","$\sigma_3$","pnm_3","$p(M=1|S=3)$")
tmp$sim &lt;- 1:nsim
tmp &lt;- gather(tmp,key="param",value="estimate",-sim)
tmp$true &lt;- rep(truepars2,each=nsim)
tmp$method &lt;- "MNAR"
tmp$variance &lt;- "low"
tmp$missing &lt;- "equal"
sim4_est2_long &lt;- tmp

all_long &lt;- rbind(
  sim4_est1_long,
  subset(sim4_est2_long,!(param 
)

my_table &lt;- all_long 
  group_by(param, method, variance, missing) 
  summarize(true = mean(true),
            mean = mean(estimate),
            sd = sd(estimate),
            bias = mean(abs(true - estimate)/abs(true)),
            MAE = mean(abs(true - estimate))) 
  gather(measure,value,-c(param,method,variance,missing)) 
  recast(param + variance + missing  ~  method + measure)

MAR_simulation_results &lt;- my_table 
  filter(variance == "low" &amp; missing == "equal") 
  dplyr::select(param,MAR_true,paste0("MAR_",c("mean","sd","MAE"),sep=""),
                paste0("MNAR_",c("mean","sd","MAE"),sep="")) 
  mutate(percMAE = MNAR_MAE/MAR_MAE) 

colnames(MAR_simulation_results) &lt;- c("parameter", "true", "MAR_estimates_mean", 
  "MAR_estimates_sd", "MAR_estimates_MAE", "MNAR_estimates_mean",
  "MNAR_estimates_sd", "MNAR_estimates_MAE", "percMAE")
MAR_simulation_results &lt;- MAR_simulation_results[c(1:3,7:9,4:6,10:21),]
</pre>


<h3>Examples</h3>

<pre><code class="language-R">  data(MAR_simulation_results)
</code></pre>


</div>
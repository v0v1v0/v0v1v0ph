<div class="container">

<table style="width: 100%;"><tr>
<td>linear_pool</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute ensemble model outputs as a linear pool, otherwise known as a
distributional mixture, of component model outputs for
each combination of model task, output type, and output type id. Supported
output types include <code>mean</code>, <code>quantile</code>, <code>cdf</code>, and <code>pmf</code>.</h2>

<h3>Description</h3>

<p>Compute ensemble model outputs as a linear pool, otherwise known as a
distributional mixture, of component model outputs for
each combination of model task, output type, and output type id. Supported
output types include <code>mean</code>, <code>quantile</code>, <code>cdf</code>, and <code>pmf</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">linear_pool(
  model_out_tbl,
  weights = NULL,
  weights_col_name = "weight",
  model_id = "hub-ensemble",
  task_id_cols = NULL,
  n_samples = 10000,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model_out_tbl</code></td>
<td>
<p>an object of class <code>model_out_tbl</code> with component
model outputs (e.g., predictions).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>an optional <code>data.frame</code> with component model weights. If
provided, it should have a column named <code>model_id</code> and a column containing
model weights. Optionally, it may contain additional columns corresponding
to task id variables, <code>output_type</code>, or <code>output_type_id</code>, if weights are
specific to values of those variables. The default is <code>NULL</code>, in which case
an equally-weighted ensemble is calculated. Should be prevalidated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights_col_name</code></td>
<td>
<p><code>character</code> string naming the column in <code>weights</code>
with model weights. Defaults to <code>"weight"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_id</code></td>
<td>
<p><code>character</code> string with the identifier to use for the
ensemble model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>task_id_cols</code></td>
<td>
<p><code>character</code> vector with names of columns in
<code>model_out_tbl</code> that specify modeling tasks. Defaults to <code>NULL</code>, in which
case all columns in <code>model_out_tbl</code> other than <code>"model_id"</code>, <code>"output_type"</code>,
<code>"output_type_id"</code>, and <code>"value"</code> are used as task ids.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_samples</code></td>
<td>
<p><code>numeric</code> that specifies the number of samples to use when
calculating quantiles from an estimated quantile function. Defaults to <code>1e4</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>parameters that are passed to <code>distfromq::make_q_fn</code>, specifying
details of how to estimate a quantile function from provided quantile levels
and quantile values for <code>output_type</code> <code>"quantile"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The underlying mechanism for the computations varies for different
<code>output_type</code>s. When the <code>output_type</code> is <code>cdf</code>, <code>pmf</code>, or <code>mean</code>, this
function simply calls <code>simple_ensemble</code> to calculate a (weighted) mean of the
component model outputs. This is the definitional calculation for the CDF or
PMF of a linear pool. For the <code>mean</code> output type, this is justified by the fact
that the (weighted) mean of the linear pool is the (weighted) mean of the means
of the component distributions.
</p>
<p>When the <code>output_type</code> is <code>quantile</code>, we obtain the quantiles of a linear pool
in three steps:
</p>

<ol>
<li>
<p> Interpolate and extrapolate from the provided quantiles for each component
model to obtain an estimate of the CDF of that distribution.
</p>
</li>
<li>
<p> Draw samples from the distribution for each component model. To reduce
Monte Carlo variability, we use quasi-random samples corresponding to
quantiles of the estimated distribution.
</p>
</li>
<li>
<p> Collect the samples from all component models and extract the desired
quantiles.
</p>
</li>
</ol>
<p>Steps 1 and 2 in this process are performed by <code>distfromq::make_q_fn</code>.
</p>


<h3>Value</h3>

<p>a <code>model_out_tbl</code> object of ensemble predictions. Note that any
additional columns in the input <code>model_out_tbl</code> are dropped.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># We illustrate the calculation of a linear pool when we have quantiles from the
# component models. We take the components to be normal distributions with
# means -3, 0, and 3, all standard deviations 1, and weights 0.25, 0.5, and 0.25.
data(component_outputs)
data(weights)

expected_quantiles &lt;- seq(from = -5, to = 5, by = 0.25)
lp_from_component_qs &lt;- linear_pool(component_outputs, weights)

head(lp_from_component_qs)
all.equal(lp_from_component_qs$value, expected_quantiles, tolerance = 1e-2,
          check.attributes = FALSE)

</code></pre>


</div>
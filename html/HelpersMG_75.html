<div class="container">

<table style="width: 100%;"><tr>
<td>RandomFromHessianOrMCMC</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Random numbers based on Hessian matrix or MCMC</h2>

<h3>Description</h3>

<p>If it is very long, use silent parameter to check if something goes wrong.<br>
If replicates is NULL or is 0, or if method is NULL, parameters are just copied into data.frame.
</p>


<h3>Usage</h3>

<pre><code class="language-R">RandomFromHessianOrMCMC(
  se = NULL,
  Hessian = NULL,
  mcmc = NULL,
  chain = 1,
  regularThin = TRUE,
  MinMax = NULL,
  fitted.parameters = NULL,
  fixed.parameters = NULL,
  method = NULL,
  probs = c(0.025, 0.5, 0.975),
  replicates = 10000,
  fn = NULL,
  silent = FALSE,
  ParTofn = "par",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>A named vector with SE of parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Hessian</code></td>
<td>
<p>An Hessian matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc</code></td>
<td>
<p>A result from MHalgogen()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chain</code></td>
<td>
<p>MCMC chain to be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regularThin</code></td>
<td>
<p>If TRUE, use regular thin for MCMC</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MinMax</code></td>
<td>
<p>A data.frame with at least two columns: Min and Max and rownames being the variable names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted.parameters</code></td>
<td>
<p>The fitted parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.parameters</code></td>
<td>
<p>The fixed parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Can be NULL, "SE", "Hessian", "MCMC", or "PseudoHessianFromMCMC"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>Probability for quantiles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replicates</code></td>
<td>
<p>Number of replicates to generate the randoms</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn</code></td>
<td>
<p>The function to apply to each replicate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>Should the function display some information</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ParTofn</code></td>
<td>
<p>Name of the parameter to send random values to fn</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Parameters send to fn function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>RandomFromHessianOrMCMC returns random numbers based on Hessian matrix or MCMC
</p>


<h3>Value</h3>

<p>Returns a list with three data.frames named random, fn, and quantiles
</p>


<h3>Author(s)</h3>

<p>Marc Girondot <a href="mailto:marc.girondot@gmail.com">marc.girondot@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(HelpersMG)
val &lt;- rnorm(100, mean=20, sd=5)+(1:100)/10
# Return -ln L of values in val in Gaussian distribution with mean and sd in par
fitnorm &lt;- function(par, data) {
  -sum(dnorm(data, par["mean"], abs(par["sd"]), log = TRUE))
}
# Initial values for search
p&lt;-c(mean=20, sd=5)
# fit the model
result &lt;- optim(par=p, fn=fitnorm, data=val, method="BFGS", hessian=TRUE)
# Using Hessian
df &lt;- RandomFromHessianOrMCMC(Hessian=result$hessian, 
                              fitted.parameters=result$par, 
                              method="Hessian")$random
hist(df[, 1], main="mean")
hist(df[, 2], main="sd")
plot(df[, 1], df[, 2], xlab="mean", ylab="sd", las=1, bty="n")

# Using MCMC
parameters_mcmc &lt;- data.frame(Density=c('dnorm', 'dlnorm'), 
Prior1=c(10, 0.5), Prior2=c(2, 0.5), SDProp=c(0.35, 0.2), 
Min=c(-3, 0), Max=c(100, 10), Init=c(10, 2), stringsAsFactors = FALSE, 
row.names=c('mean', 'sd'))
# Use of trace and traceML parameters
# trace=1 : Only one likelihood is printed
mcmc_run &lt;- MHalgoGen(n.iter=50000, parameters=parameters_mcmc, data=val, 
parameters_name = "par", 
likelihood=fitnorm, n.chains=1, n.adapt=100, thin=1, trace=1)
df &lt;- RandomFromHessianOrMCMC(mcmc=mcmc_run, fitted.parameters=NULL, 
                              method="MCMC")$random
hist(df[, 1], main="mean")
hist(df[, 2], main="sd")
plot(df[, 1], df[, 2], xlab="mean", ylab="sd", las=1, bty="n")

# Using a function fn
fitnorm &lt;- function(par, data, x) { 
  y=par["a"]*(x)+par["b"]
  -sum(dnorm(data, y, abs(par["sd"]), log = TRUE))
}
p&lt;-c(a=0.1, b=20, sd=5)
# fit the model
x &lt;- 1:100
result &lt;- optim(par=p, fn=fitnorm, data=val, x=x, method="BFGS", hessian=TRUE)
# Using Hessian
df &lt;- RandomFromHessianOrMCMC(Hessian=result$hessian, fitted.parameters=result$par, 
                              method="Hessian", 
                              fn=function(par) (par["a"]*(x)+par["b"]))
plot(1:100, val)
lines(1:100, df$quantiles["50%", ])
lines(1:100, df$quantiles["2.5%", ], lty=2)
lines(1:100, df$quantiles["97.5%", ], lty=2)

## End(Not run)
</code></pre>


</div>
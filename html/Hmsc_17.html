<div class="container">

<table style="width: 100%;"><tr>
<td>Hmsc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Hmsc</h2>

<h3>Description</h3>

<p>Creates an <code>Hmsc</code>-class object
</p>


<h3>Usage</h3>

<pre><code class="language-R">Hmsc(
  Y,
  XFormula = ~.,
  XData = NULL,
  X = NULL,
  XScale = TRUE,
  XSelect = NULL,
  XRRRData = NULL,
  XRRRFormula = ~. - 1,
  XRRR = NULL,
  ncRRR = 2,
  XRRRScale = TRUE,
  YScale = FALSE,
  studyDesign = NULL,
  ranLevels = NULL,
  ranLevelsUsed = names(ranLevels),
  TrFormula = NULL,
  TrData = NULL,
  Tr = NULL,
  TrScale = TRUE,
  phyloTree = NULL,
  C = NULL,
  distr = "normal",
  truncateNumberOfFactors = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>a matrix of species occurences or abundances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XFormula</code></td>
<td>
<p>a <code>formula</code>-class object for fixed effects
(linear regression)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XData</code></td>
<td>
<p>a data frame of measured covariates for fixed effects with
<code>formula</code>-based specification</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a matrix of measured covariates for fixed effects with direct specification</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XScale</code></td>
<td>
<p>a boolean flag indicating whether to scale covariates for the fixed effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XSelect</code></td>
<td>
<p>a list describing how variable selection is to be applied</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XRRRData</code></td>
<td>
<p>a data frame of covariates for reduced-rank regression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XRRRFormula</code></td>
<td>
<p><code>formula</code> for reduced-rank regression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XRRR</code></td>
<td>
<p>a matrix of covariates for reduced-rank regression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncRRR</code></td>
<td>
<p>number of covariates (linear combinations) for reduced-rank regression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>XRRRScale</code></td>
<td>
<p>a boolean flag indicating whether to scale covariates for reduced-rank regression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>YScale</code></td>
<td>
<p>a boolean flag whether to scale responses for which normal distribution is assumed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>studyDesign</code></td>
<td>
<p>a data frame of correspondence between sampling units and units on different levels of latent
factors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranLevels</code></td>
<td>
<p>a named list of <code>HmscRandomLevel</code>-class objects, specifying the structure and data for random
levels</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranLevelsUsed</code></td>
<td>
<p>a vector with names of levels of latent factors that are used in the analysis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TrFormula</code></td>
<td>
<p>a <code>formula</code>-class object for regression
dependence of <code class="reqn">\beta_{kj}</code> coefficients on species traits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TrData</code></td>
<td>
<p>a data frame of measured species traits for
<code>formula</code>-based specification</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tr</code></td>
<td>
<p>a matrix of measured traits for direct specification</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TrScale</code></td>
<td>
<p>a boolean flag whether to scale values of species traits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phyloTree</code></td>
<td>
<p>a phylogenetic tree (object of class <code>phylo</code> or <code>corPhyl</code>) for species in <code>Y</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>a phylogenic correlation matrix for species in <code>Y</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distr</code></td>
<td>
<p>a string shortcut or <code class="reqn">n_s \times 2</code> matrix specifying the observation models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>truncateNumberOfFactors</code></td>
<td>
<p>logical, reduces the maximal number of latent factor to be at most the number of species</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Matrix <code class="reqn">Y</code> may contain missing values, but it is not recommended to add a
species/sampling unit with fully missing data, since those do not bring any new additional information.
</p>
<p>Only one of <code>XFormula</code>-<code>XData</code> and <code>X</code> arguments can be specified. Similar requirement applies to
<code>TrFormula</code>-<code>TrData</code> and <code>Tr</code>. It is recommended to use the specification with <code>formula</code>,
since that information enables additional features for postprocessing of the fitted model.
</p>
<p>As default, scaling is applied for <code>X</code> and <code>Tr</code> matrices, but not for <code>Y</code> matrix. If the <code>X</code> and/or <code>Tr</code> matrices are
scaled, the estimated parameters are back-transformed so that the estimated parameters correspond to the original
<code>X</code> and <code>Tr</code> matrices, not the scaled ones. In contrast, if <code>Y</code> is scaled, the estimated parameters are not
back-transformed because doing so is not possible for all model parameters. Thus, the estimated parameters
correspond to the scaled <code>Y</code> matrix, not the original one. If the <code>Y</code> matrix is scaled, the predictions
generated by <code>predict</code> are back-transformed, so that the predicted <code>Y</code> matrices are directly comparable
to the original <code>Y</code> matrix. If default priors are assumed, it is recommended that all matrices (<code>X</code>, <code>Tr</code> and <code>Y</code>) are scaled.
</p>
<p>The object <code>XSelect</code> is a list. Each object of the list <code>Xsel = XSelect[[i]]</code> is a named list with objects
<code>Xsel$covGroup</code>, <code>Xsel$spGroup</code> and <code>Xsel$q</code>. The parameter <code>covGroup</code> is a vector containing
the columns of the matrix <code>X</code> for which variable selection is applied. The parameter <code>spGroup</code>
is a vector of length equal to the number of species <code>ns</code>, with values <code>1,...,ng</code>,
where <code>ng</code> is the number of
groups of species for which variable selection is applied simultanously. The parameter
<code>q</code> is a vector of length <code>ng</code>, containing the prior probabilities by which the variables
are to be included.
For example, choosing <code>covGroup = c(2,3)</code>, <code>spGroup = rep(1,ns)</code> and <code>q=0.1</code> either includes
or excludes both of the covariates 2 and 3 simultaneously for all species. For another example, choosing <code>covGroup = c(2,3)</code>,
<code>spGroup = 1:ns</code> and <code>q=rep(0.1,ns)</code> either includes
or excludes both of the covariates 2 and 3 separately for each species.
</p>
<p>The included random levels are specified by the <code>ranLevels</code> and <code>ranLevelsUsed</code> arguments. The
correspondence between units of each random level and rows of <code>Y</code> must be specified by a column of
<code>studyDesign</code>, which corresponds to the name of a list item in <code>ranLevels</code>. It is
possible to provide an arbitrary number of columns in <code>studyDesign</code> that are not listed in <code>ranLevels</code>.
These do not affect the model formulation or fitting scheme, but can be utilized during certain functions
postprocessing the results of statistical model fit.
</p>
<p>The <code>distr</code> argument may be either a matrix, a string literal, or a vector of string literals. In the case of
a matrix, the dimension must be <code class="reqn">n_s \times 2</code>, where the first column defines the family of the observation
model and the second argument defines the dispersion property. The elements of the first column must take values
1-normal, 2-probit and 3-Poisson with log link function. The second argument stands for the dispersion parameter
being fixed (0) or estimated (1). The default fixed values of the dispersion parameters are 1 for normal and probit,
and 0.01 for Poisson (implemented as a limiting case of lognormally-overdispersed Poisson). Alternatively, a string
literal shortcut can be given as a value to the <code>distr</code> argument, simultaniously specifying similar class of
observation models for all species. The available shortcuts are <code>"normal"</code>, <code>"probit"</code>, <code>"poisson"</code>,
<code>"lognormal poisson"</code>. If <code>distr</code> is a vector of string literals, each element corresponds to one species,
should be either <code>"normal"</code>, <code>"probit"</code>, <code>"poisson"</code>, <code>"lognormal poisson"</code>,
and these can be abbreviated as long as they are unique strings.
The matrix argument and the vector of string literals allows specifying different observation
models for different species.
</p>
<p>By default this constructor assigns default priors to the latent factors. Those priors are designed to be
reasonably flat assuming that the covariates, species traits and normally distributed responses are scaled.
In case when other priors needed to be specified, a call of <code>setPriors.Hmsc</code> methods should be made,
where the particular priors may be specified.
</p>


<h3>Value</h3>

<p>An object of <code>Hmsc</code> class without any posterior samples.
</p>


<h3>See Also</h3>

<p><code>HmscRandomLevel</code>, <code>sampleMcmc</code>, <code>setPriors.Hmsc</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Creating a Hmsc object without phylogeny, trait data or random levels
m = Hmsc(Y=TD$Y, XData=TD$X, XFormula=~x1+x2)

# Creating a Hmsc object with phylogeny and traits
m = Hmsc(Y=TD$Y, XData=TD$X, XFormula=~x1+x2,
TrData=TD$Tr, TrFormula=~T1+T2, phyloTree=TD$phylo)

# Creating a Hmsc object with 2 nested random levels (50 sampling units in 20 plots)
studyDesign = data.frame(sample = as.factor(1:50), plot = as.factor(sample(1:20,50,replace=TRUE)))
rL1 = HmscRandomLevel(units=levels(TD$studyDesign$plot))
rL2 = HmscRandomLevel(units=levels(TD$studyDesign$sample))
m = Hmsc(Y=TD$Y, XData=TD$X, XFormula=~x1+x2,
studyDesign=studyDesign,ranLevels=list("sample"=rL1,"plot"=rL2))

</code></pre>


</div>
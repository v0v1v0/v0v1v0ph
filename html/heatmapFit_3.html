<div class="container">

<table style="width: 100%;"><tr>
<td>heatmap.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Heatmap Fit Statistic for Binary Dependent Variable Models</h2>

<h3>Description</h3>

<p>Generates a fit plot for diagnosing misspecification in models of binary dependent variables, and calculates the related heatmap fit statistic (Esarey and Pierce, 2012).
</p>


<h3>Usage</h3>

<pre><code class="language-R">heatmap.fit(y, pred, calc.boot = TRUE, reps = 1000, span.l = "aicc",
  color = FALSE, compress.obs = TRUE, init.grid = 2000, ret.obs = FALSE,
  legend = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A vector of observations of the dependent variable (in {0,1}).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>A vector of model-predicted Pr(y = 1) corresponding to each element of <code>y</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calc.boot</code></td>
<td>
<p>Calculate bootstrap-based p-values (default = <code>TRUE</code>) or not (= <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reps</code></td>
<td>
<p>Number of bootstrap replicates to generate (default = 1000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>span.l</code></td>
<td>
<p>Bandwidth for the nonparametric fit between <code>y</code> and <code>pred</code>. Defaults to "aicc", calculation of an AICc-minimizing bandwidth. Other options are "gcv", which minimizes the generalized cross-validation statistic, or a numerical bandwidth.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color</code></td>
<td>
<p>Whether the plot should be in color (<code>TRUE</code>) or grayscale (the default, <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compress.obs</code></td>
<td>
<p>Whether large data sets should be compressed by pre-binning to save computing time (default <code>TRUE</code>). When true, only data sets larger than 10,000 observations will be compressed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.grid</code></td>
<td>
<p>If <code>compress.obs = TRUE</code>, the number of bins on the interval [0, 1] to use for compression of <code>pred</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ret.obs</code></td>
<td>
<p>Return the one-tailed bootstrap p-value for each observation in <code>y</code> (<code>TRUE</code>) or not (the default, <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>Print the legend on the heat map plot (the default, <code>TRUE</code>) or not (<code>FALSE</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function plots the degree to which a binary dependent variable (BDV) model generates predicted probabilities that are an accurate match for observed empirical probabilities of the BDV, in-sample or out-of-sample. For example, if a model predicts that Pr(y = 1) = k%, about k% of observations with this predicted probability should have y = 1. Loess smoothing (with an automatically-selected optimum bandwidth) is used to estimate empirical probabilities in the data set and to overcome sparseness of the data. Systematic deviations are distinguished from sampling variation via bootstrapping of the distribution under the null that the model is an accurate predictor, with p-values indicating the one-tailed proportion of bootstrap samples that are less-extreme than the observed deviation. The plot shows model predicted probabilities on the x-axis and smoothed empirical probabilities on the y-axis, with a histogram indicating the location and frequency of observations. The ideal fit is a 45-degree line. The shading of the plotted line indicates the degree to which fit deviations are larger than expected due to sampling variation.
</p>
<p>A summary statistic for fit (the "heatmap statistic") is also reported. This statistic is the proportion of the sample in a region with one-tailed p-value less than or equal to 10%. Finding more than 20% of the dataset with this p-value in this region is diagnostic of misspecification in the model.
</p>
<p>More details for the technique are given in Esarey and Pierce 2012, "Assessing Fit Quality and Testing for Misspecification in Binary Dependent Variable Models," <em>Political Analysis</em> 20(4): 480-500.
</p>


<h3>Value</h3>

<p>If <code>ret.obs = T</code>, a list with the element:
</p>
<table><tr style="vertical-align: top;">
<td><code>heatmap.obs.p</code></td>
<td>
<p>The one-tailed bootstrap p-value corresponding to each observation in <code>y</code>.</p>
</td>
</tr></table>
<h3>Note</h3>

<p>Code to calculate AICc and GCV written by Michael Friendly (http://tolstoy.newcastle.edu.au/R/help/05/11/15899.html).
</p>


<h3>Author(s)</h3>

<p>Justin Esarey &lt;justin@justinesarey.com&gt;
</p>
<p>Andrew Pierce &lt;awpierc@emory.edu&gt;
</p>
<p>Jericho Du &lt;jericho.du@gmail.com&gt;
</p>


<h3>References</h3>

<p>Esarey, Justin and Andrew Pierce (2012). "Assessing Fit Quality and Testing for Misspecification in Binary Dependent Variable Models." <em>Political Analysis</em> 20(4): 480-500. DOI:10.1093/pan/mps026.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
## a correctly specified model
###############################

set.seed(123456)
x &lt;- runif(20000)
y &lt;- as.numeric( runif(20000) &lt; pnorm(2*x - 1) )
mod &lt;- glm( y ~ x, family=binomial(link="probit"))
pred &lt;- predict(mod, type="response")

heatmap.fit(y, pred, reps=1000)

## out-of-sample prediction w/o bootstrap p-values

set.seed(654321)
x &lt;- runif(1000)
y &lt;- as.numeric( runif(1000) &lt; pnorm(2*x - 1) )
pred &lt;- predict(mod, type="response", newdata=data.frame(x))

heatmap.fit(y, pred, calc.boot=FALSE)



## a misspecified model
########################

set.seed(13579)
x &lt;- runif(20000)
y &lt;- as.numeric( runif(20000) &lt; pnorm(sin(10*x)) )
mod &lt;- glm( y ~ x, family=binomial(link="probit"))
pred &lt;- predict(mod, type="response")
heatmap.fit(y, pred, reps=1000)

## Comparison with and without data compression

system.time(heatmap.fit(y, pred, reps=100))
system.time(heatmap.fit(y, pred, reps=100, compress.obs=FALSE))

## End(Not run)

</code></pre>


</div>